<!DOCTYPE html><html><head>
      <title>mordern_c++</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\DOC\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.18\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#qt-c-培训" class="md-toc-link"><p>QT C++ 培训</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day1-环境安装和入门20250305" class="md-toc-link"><p>Day1 环境安装和入门（2025.03.05）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#qt-自带的编译器" class="md-toc-link">
            <p>Qt 自带的编译器</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#qt-的编译脚本qmake--cmake" class="md-toc-link"><p>Qt 的编译脚本：qmake / CMake</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#示例testpro-文件" class="md-toc-link">
            </a><p><a href="#示例testpro-文件" class="md-toc-link"><strong>示例：</strong></a><strong><a href="http://Test.pro">Test.pro</a> 文件</strong></p>

          </div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#qt-的版本控制系统" class="md-toc-link">
            <p>Qt 的版本控制系统</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#c-中的头文件" class="md-toc-link">
            <p>C++ 中的头文件</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#c-中的命名空间" class="md-toc-link">
            <p>C++ 中的命名空间</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#c-中的编译-链接-运行" class="md-toc-link">
            <p>C++ 中的编译、链接、运行</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day2-c语法和工程实践20250306" class="md-toc-link"><p>Day2 C++语法和工程实践（2025.03.06）</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#c中的内置类型" class="md-toc-link"><p>C++中的内置类型</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-基本数据类型" class="md-toc-link">
            <ol>
<li>基本数据类型</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-布尔类型" class="md-toc-link">
            <ol start="2">
<li>布尔类型</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-空类型" class="md-toc-link">
            <ol start="3">
<li>空类型</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-类型限定符" class="md-toc-link">
            <ol start="4">
<li>类型限定符</li>
</ol>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#c中的自定义类型" class="md-toc-link"><p>C++中的自定义类型</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-类class" class="md-toc-link">
            <ol>
<li>类（Class）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-结构体struct" class="md-toc-link">
            <ol start="2">
<li>结构体（Struct）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-枚举enum" class="md-toc-link">
            <ol start="3">
<li>枚举（Enum）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-类型别名type-aliases" class="md-toc-link">
            <ol start="4">
<li>类型别名（Type Aliases）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-模板template" class="md-toc-link">
            <ol start="5">
<li>模板（Template）</li>
</ol>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#左值右值" class="md-toc-link"><p>左值/右值</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-左值lvalue" class="md-toc-link">
            <ol>
<li>左值（Lvalue）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-右值rvalue" class="md-toc-link">
            <ol start="2">
<li>右值（Rvalue）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-左值引用与右值引用" class="md-toc-link">
            <ol start="3">
<li>左值引用与右值引用</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-重要概念" class="md-toc-link">
            <ol start="4">
<li>重要概念</li>
</ol>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#指针引用" class="md-toc-link"><p>指针/引用</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#-1-指针pointer" class="md-toc-link"><p>📌 1. 指针（Pointer）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-什么是指针" class="md-toc-link">
            <p>1.1 什么是指针？</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#12-指针的语法" class="md-toc-link">
            <p>1.2 指针的语法</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#13-常见操作" class="md-toc-link">
            <p>1.3 常见操作</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#14-指针的种类" class="md-toc-link">
            <p>1.4 指针的种类</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#15-动态内存分配" class="md-toc-link">
            <p>1.5 动态内存分配</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#-2-引用reference" class="md-toc-link"><p>📌 2. 引用（Reference）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-什么是引用" class="md-toc-link">
            <p>2.1 什么是引用？</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#22-引用的特点" class="md-toc-link">
            <p>2.2 引用的特点</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#23-常量引用" class="md-toc-link">
            <p>2.3 常量引用</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-3-指针与引用的区别" class="md-toc-link">
            <p>📌 3. 指针与引用的区别</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#-4-指针和引用在函数中的应用" class="md-toc-link"><p>📌 4. 指针和引用在函数中的应用</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#41-通过指针修改参数" class="md-toc-link">
            <p>4.1 通过指针修改参数</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#42-通过引用修改参数" class="md-toc-link">
            <p>4.2 通过引用修改参数</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#43-指针和引用的混合使用" class="md-toc-link">
            <p>4.3 指针和引用的混合使用</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-5-什么时候用指针什么时候用引用" class="md-toc-link">
            <p>📌 5. 什么时候用指针？什么时候用引用？</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-6-小结" class="md-toc-link">
            <p>🎯 6. 小结</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#优秀实践" class="md-toc-link">
            <p>优秀实践</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day3-移动语义和构造析构拷贝构造20250307" class="md-toc-link"><p>Day3 移动语义和构造/析构/拷贝构造（2025.03.07）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#进程的内存映像" class="md-toc-link">
            <p>进程的内存映像</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#栈和堆" class="md-toc-link">
            <p>栈和堆</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#new和malloc" class="md-toc-link">
            <p>new和malloc</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#类和对象" class="md-toc-link"><p>类和对象</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-类class-1" class="md-toc-link">
            <ol>
<li>类（Class）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-结构体struct-1" class="md-toc-link">
            <ol start="2">
<li>结构体（Struct）</li>
</ol>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day4-1-智能指针20250318" class="md-toc-link"><p>Day4-1 智能指针（2025.03.18）</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#智能指针的用法" class="md-toc-link"><p>智能指针的用法</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#myclass类头文件" class="md-toc-link">
            <p>MyClass类头文件</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#myclass类实现文件" class="md-toc-link">
            <p>MyClass类实现文件</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#主程序maincpp" class="md-toc-link">
            <p>主程序main.cpp</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day4-2移动构造函数和移动赋值运算符-c20250319" class="md-toc-link"><p>Day4-2移动构造函数和移动赋值运算符 (C++)（2025.03.19）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#为-c-创建移动构造函数" class="md-toc-link">
            <p>为 C++ 创建移动构造函数</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#为-c-类创建移动赋值运算符" class="md-toc-link">
            <p>为 C++ 类创建移动赋值运算符</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#示例完成移动构造函数和赋值运算符" class="md-toc-link">
            <p>示例：完成移动构造函数和赋值运算符</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#示例-使用移动语义来提高性能" class="md-toc-link">
            <p>示例 使用移动语义来提高性能</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#可靠编程" class="md-toc-link">
            <p>可靠编程</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day4-3-c四大函数构造拷贝构造析构赋值运算符函数20250319" class="md-toc-link"><p>Day4-3 C++四大函数（构造/拷贝构造/析构/赋值运算符函数）（2025.03.19）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#point类" class="md-toc-link">
            <p>Point类</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#computer类" class="md-toc-link">
            <p>Computer类</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day4-4-new-与-delete-表达式20250320" class="md-toc-link"><p>Day4-4 New 与 delete 表达式（2025.03.20）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-new-表达式的三个步骤" class="md-toc-link">
            <ol>
<li><code>new</code> 表达式的三个步骤</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-delete-表达式的两个步骤" class="md-toc-link">
            <ol start="2">
<li><code>delete</code> 表达式的两个步骤</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-new-与-delete" class="md-toc-link">
            <ol start="3">
<li><code>new[]</code> 与 <code>delete[]</code></li>
</ol>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day5-类的定义和关键字再探20250324" class="md-toc-link"><p>Day5 类的定义和关键字再探（2025.03.24）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-c-关键字-const-static-extern" class="md-toc-link">
            <ol>
<li>C++ 关键字 <code>const</code>、<code>static</code>、<code>extern</code></li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-类的定义circle-和-rect" class="md-toc-link">
            <ol start="2">
<li>类的定义：Circle 和 Rect</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-完整代码" class="md-toc-link">
            <ol start="3">
<li>完整代码</li>
</ol>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day5-1-运算符重载20250324" class="md-toc-link"><p>Day5-1 运算符重载（2025.03.24）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-复数类-complex-及其运算符重载" class="md-toc-link">
            <ol>
<li>复数类 <code>Complex</code> 及其运算符重载</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-运算符重载的几种方式" class="md-toc-link">
            <ol start="2">
<li>运算符重载的几种方式</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-关键区别" class="md-toc-link">
            <ol start="3">
<li>关键区别</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4完整代码" class="md-toc-link">
            <p>4.完整代码</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day5-2-文件io20250324" class="md-toc-link"><p>Day5-2 文件IO（2025.03.24）</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1-缓冲区与刷新" class="md-toc-link"><ol>
<li>缓冲区与刷新</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-常见的缓冲刷新方式" class="md-toc-link">
            <p>1.1 常见的缓冲刷新方式</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-文件读写操作" class="md-toc-link"><ol start="2">
<li>文件读写操作</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-读取文件" class="md-toc-link">
            <p>2.1 读取文件</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#22-写入文件" class="md-toc-link">
            <p>2.2 写入文件</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#23-追加模式写入" class="md-toc-link">
            <p>2.3 追加模式写入</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#23-完整代码" class="md-toc-link">
            <p>2.3 完整代码</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-文件定位操作" class="md-toc-link">
            <ol start="3">
<li>文件定位操作</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-字符串io" class="md-toc-link">
            <ol start="4">
<li>字符串IO</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-配置文件解析示例" class="md-toc-link">
            <ol start="5">
<li>配置文件解析示例</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-完整代码" class="md-toc-link">
            <ol start="6">
<li>完整代码</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-二进制文件操作" class="md-toc-link">
            <ol start="7">
<li>二进制文件操作</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#总结" class="md-toc-link">
            <p>总结</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day6-1-输入输出流运算符重载20250325" class="md-toc-link"><p><strong>Day6-1 输入输出流运算符重载（2025.03.25）</strong></p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1-回顾" class="md-toc-link"><p><strong>1. 回顾</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-拷贝构造函数的调用时机" class="md-toc-link">
            <p><strong>1.1 拷贝构造函数的调用时机</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-友元" class="md-toc-link"><p><strong>2. 友元</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-友元函数" class="md-toc-link">
            <p><strong>2.1 友元函数</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-输入输出流运算符重载" class="md-toc-link"><p><strong>3. 输入输出流运算符重载</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#31-关键知识点" class="md-toc-link">
            <p><strong>3.1 关键知识点</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#32-代码" class="md-toc-link">
            <p><strong>3.2 代码</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#33-关键问题" class="md-toc-link">
            <p><strong>3.3 关键问题</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#34-完整代码" class="md-toc-link">
            <p><strong>3.4 完整代码</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4-下标访问运算符-operator" class="md-toc-link"><p><strong>4. 下标访问运算符 <code>operator[]</code></strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#41-关键知识点" class="md-toc-link">
            <p><strong>4.1 关键知识点</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#42-代码" class="md-toc-link">
            <p><strong>4.2 代码</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#5-函数调用运算符-operator" class="md-toc-link"><p><strong>5. 函数调用运算符 <code>operator()</code></strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#51-关键知识点" class="md-toc-link">
            <p><strong>5.1 关键知识点</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#52-代码" class="md-toc-link">
            <p><strong>5.2 代码</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#53-示例" class="md-toc-link">
            <p><strong>5.3 示例</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#54-完整代码" class="md-toc-link">
            <p><strong>5.4 完整代码</strong></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#day6-2-成员访问运算符重载20250325" class="md-toc-link">
            <p><strong>Day6-2 成员访问运算符重载（2025.03.25）</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-复习" class="md-toc-link">
            <p><strong>1. 复习</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-成员访问运算符重载" class="md-toc-link"><p><strong>2. 成员访问运算符重载</strong></p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#21-箭头运算符---重载" class="md-toc-link"><p><strong>2.1 箭头运算符 (<code>-&gt;</code>) 重载</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-语法" class="md-toc-link">
            <p><strong>(1) 语法</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#22-解引用运算符--重载" class="md-toc-link"><p><strong>2.2 解引用运算符 (<code>*</code>) 重载</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-语法-1" class="md-toc-link">
            <p><strong>(1) 语法</strong></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-代码分析" class="md-toc-link"><p><strong>3. 代码分析</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#31-代码结构" class="md-toc-link">
            <p><strong>3.1 代码结构</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#32-代码解析" class="md-toc-link"><p><strong>3.2 代码解析</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-data-类" class="md-toc-link">
            <p><strong>(1) <code>Data</code> 类</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-secondlayer-类" class="md-toc-link">
            <p><strong>(2) <code>SecondLayer</code> 类</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-thirdlayer-类" class="md-toc-link">
            <p><strong>(3) <code>ThirdLayer</code> 类</strong></p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#33-运行-test-方法" class="md-toc-link">
            <p><strong>3.3 运行 <code>test()</code> 方法</strong></p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-总结" class="md-toc-link">
            <p><strong>4. 总结</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day6-3-类型转换函数和类域" class="md-toc-link"><p><strong>Day6-3 类型转换函数和类域</strong></p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1-类型转换函数type-conversion-functions" class="md-toc-link"><p><strong>1. 类型转换函数（Type Conversion Functions）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-概述" class="md-toc-link">
            <p><strong>1.1 概述</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#12-代码示例" class="md-toc-link">
            <p><strong>1.2 代码示例</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#13-关键优化" class="md-toc-link">
            <p><strong>1.3 关键优化</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-类域class-scope" class="md-toc-link"><p><strong>2. 类域（Class Scope）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-作用域-vs-可见域" class="md-toc-link">
            <p><strong>2.1 作用域 vs 可见域</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#22-代码示例" class="md-toc-link">
            <p><strong>2.2 代码示例</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#23-关键优化" class="md-toc-link">
            <p><strong>2.3 关键优化</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-内部类nested-class" class="md-toc-link"><p><strong>3. 内部类（Nested Class）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#31-内部类的定义" class="md-toc-link">
            <p><strong>3.1 内部类的定义</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#32-访问外部类的-private-成员" class="md-toc-link">
            <p><strong>3.2 访问外部类的 <code>private</code> 成员</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#33-静态内部类" class="md-toc-link">
            <p><strong>3.3 静态内部类</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4-作用域运算符scope-resolution-operator-" class="md-toc-link"><p><strong>4. 作用域运算符（Scope Resolution Operator <code>::</code>）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#41-访问全局变量" class="md-toc-link">
            <p><strong>4.1 访问全局变量</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#42-访问命名空间内的变量" class="md-toc-link">
            <p><strong>4.2 访问命名空间内的变量</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#43-访问类的静态成员" class="md-toc-link">
            <p><strong>4.3 访问类的静态成员</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#5-类型转换运算符type-casting-operators" class="md-toc-link"><p><strong>5. 类型转换运算符（Type Casting Operators）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#51-static_cast-用法" class="md-toc-link">
            <p><strong>5.1 <code>static_cast</code> 用法</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#52-dynamic_cast-用法" class="md-toc-link">
            <p><strong>5.2 <code>dynamic_cast</code> 用法</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#53-const_cast-用法" class="md-toc-link">
            <p><strong>5.3 <code>const_cast</code> 用法</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#54-reinterpret_cast-用法" class="md-toc-link">
            <p><strong>5.4 <code>reinterpret_cast</code> 用法</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#6-关键字-explicit-与类型转换" class="md-toc-link"><p><strong>6. 关键字 <code>explicit</code> 与类型转换</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#61-隐式转换" class="md-toc-link">
            <p><strong>6.1 隐式转换</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#62-使用-explicit-禁止隐式转换" class="md-toc-link">
            <p><strong>6.2 使用 <code>explicit</code> 禁止隐式转换</strong></p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-总结" class="md-toc-link">
            <p><strong>7. 总结</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day7-1-智能指针雏形" class="md-toc-link"><p><strong>Day7-1 智能指针雏形</strong></p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1-独占语义和共享语义" class="md-toc-link"><p><strong>1. 独占语义和共享语义</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-概述-1" class="md-toc-link">
            <p><strong>1.1 概述</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-stdstring的实现" class="md-toc-link"><p><strong>2. std::string的实现</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-概述" class="md-toc-link">
            <p><strong>2.1 概述</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-移动语义" class="md-toc-link"><p><strong>3. 移动语义</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#31-概述" class="md-toc-link">
            <p><strong>3.1 概述</strong></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#day7-2-继承和多态" class="md-toc-link"><p><strong>Day7-2 继承和多态</strong></p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#一-继承" class="md-toc-link"><p>一、继承</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-继承的基础" class="md-toc-link">
            <p>1、继承的基础</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-继承的定义" class="md-toc-link">
            <p>2、继承的定义</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-派生类产生的过程" class="md-toc-link">
            <p>3、派生类产生的过程</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-继承的局限" class="md-toc-link">
            <p>4、继承的局限</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-访问权限" class="md-toc-link">
            <p>5、访问权限</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-protected与private继承区别" class="md-toc-link">
            <p>6、protected与private继承区别</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#二-派生类对象的构造" class="md-toc-link">
            <p>二、派生类对象的构造</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#三-派生类对象的销毁" class="md-toc-link">
            <p>三、派生类对象的销毁</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#四-多继承重要" class="md-toc-link"><p>四、多继承（重要）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-多继承基础" class="md-toc-link">
            <p>1、多继承基础</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-多继承的问题" class="md-toc-link"><p>2、多继承的问题</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-成员函数访问冲突" class="md-toc-link">
            <p>1、成员函数访问冲突</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-数据成员的存储二义性" class="md-toc-link">
            <p>2、数据成员的存储二义性</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#day7-3-基类与派生类深入" class="md-toc-link">
            <p><strong>Day7-3 基类与派生类深入</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#cday16" class="md-toc-link"><p>C++Day16</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#一-问题回顾" class="md-toc-link">
            <p>一、问题回顾</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#二-基类与派生类间的转换" class="md-toc-link">
            <p>二、基类与派生类间的转换</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#关于-base-ref--derived-的推荐程度" class="md-toc-link">
            <p><strong>关于 <code>Base&amp; ref = derived</code> 的推荐程度</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1-base--derived对象赋值发生切片" class="md-toc-link"><p><strong>1. <code>base = derived</code>（对象赋值，发生切片）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#特点" class="md-toc-link">
            <p><strong>特点：</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-base-ref--derived引用绑定无切片" class="md-toc-link"><p><strong>2. <code>Base&amp; ref = derived</code>（引用绑定，无切片）</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#特点-1" class="md-toc-link">
            <p><strong>特点：</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-推荐程度" class="md-toc-link"><p><strong>3. 推荐程度</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#更推荐的替代方案base指针" class="md-toc-link">
            <p><strong>更推荐的替代方案：<code>Base*</code>（指针）</strong></p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4-总结-1" class="md-toc-link"><p><strong>4. 总结</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#最佳实践" class="md-toc-link">
            <p><strong>最佳实践</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#三-派生类间的复制控制" class="md-toc-link">
            <p>三、派生类间的复制控制</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#四-多态重要" class="md-toc-link"><p>四、多态（重要）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-多态的基础" class="md-toc-link">
            <p>1、多态的基础</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-多态的分类" class="md-toc-link">
            <p>2、多态的分类</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-虚函数" class="md-toc-link">
            <p>3、虚函数</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-虚函数原理重要" class="md-toc-link">
            <p>4、虚函数原理（重要）</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-虚函数机制被激活的条件重要" class="md-toc-link">
            <p>5、虚函数机制被激活的条件（重要）</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-虚函数的限制" class="md-toc-link">
            <p>6、虚函数的限制</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-虚函数的访问" class="md-toc-link">
            <p>7、虚函数的访问</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#8-抽象类" class="md-toc-link">
            <p>8、抽象类</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-语法形式相似" class="md-toc-link">
            <p><strong>1. 语法形式相似</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-核心区别" class="md-toc-link"><p><strong>2. 核心区别</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-引用绑定的对象类型" class="md-toc-link">
            <p><strong>(1) 引用绑定的对象类型</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-可访问的成员" class="md-toc-link">
            <p><strong>(2) 可访问的成员</strong></p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-多态行为虚函数" class="md-toc-link">
            <p><strong>(3) 多态行为（虚函数）</strong></p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-底层机制" class="md-toc-link">
            <p><strong>3. 底层机制</strong></p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4-总结-2" class="md-toc-link"><p><strong>4. 总结</strong></p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#关键结论" class="md-toc-link">
            <p><strong>关键结论</strong></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#c-中创建线程并传入类类型的正确写法" class="md-toc-link"><p>C++ 中创建线程并传入类类型的正确写法</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-传递成员函数使用对象指针" class="md-toc-link">
            <ol>
<li>传递成员函数（使用对象指针）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-传递-lambda-表达式捕获对象" class="md-toc-link">
            <ol start="2">
<li>传递 lambda 表达式捕获对象</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-传递临时对象移动语义" class="md-toc-link">
            <ol start="3">
<li>传递临时对象（移动语义）</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-使用-stdref-传递引用" class="md-toc-link">
            <ol start="4">
<li>使用 std::ref 传递引用</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-使用智能指针" class="md-toc-link">
            <ol start="5">
<li>使用智能指针</li>
</ol>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#注意事项" class="md-toc-link"><p>注意事项</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#问题描述" class="md-toc-link">
            <p>问题描述</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#初步观察" class="md-toc-link">
            <p>初步观察</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#理解对象构造过程" class="md-toc-link">
            <p>理解对象构造过程</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#虚函数在构造函数中的行为" class="md-toc-link">
            <p>虚函数在构造函数中的行为</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#c标准的规定" class="md-toc-link">
            <p>C++标准的规定</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#示例验证" class="md-toc-link">
            <p>示例验证</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#为什么这样设计" class="md-toc-link">
            <p>为什么这样设计？</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#类似行为析构函数" class="md-toc-link">
            <p>类似行为：析构函数</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#解决方案" class="md-toc-link">
            <p>解决方案</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#总结-1" class="md-toc-link">
            <p>总结</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#最终答案" class="md-toc-link">
            <p>最终答案</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#三级标题" class="md-toc-link"><p>三级标题</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#四级标题" class="md-toc-link"><p>四级标题</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#五级标题" class="md-toc-link"><p>五级标题</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#六级标题" class="md-toc-link">
            <p>六级标题</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    
</div>
<h1 id="qt-c-培训">QT C++ 培训 </h1>
<h2 id="day1-环境安装和入门20250305">Day1 环境安装和入门（2025.03.05） </h2>
<h3 id="qt-自带的编译器">Qt 自带的编译器 </h3>
<p>Qt 使用 MinGW 作为其默认的编译器。MinGW 是基于 GCC 的编译器，而在 Java 和 Python 中，分别可以使用 Maven 和 <code>pip install</code> 等工具安装依赖或第三方库。</p>
<p>C++ 由标准委员会指定标准，不同厂商会实现自己的编译器和标准库。Qt 致力于跨平台开发，封装了一套跨平台的库，但并不是“一次编译，到处运行”。</p>
<p>C++ 参考手册指出，从 C++11 开始，C++ 进入了一个较快的发展阶段，每三年就会有一个新版本发布。</p>
<h3 id="qt-的编译脚本qmake--cmake">Qt 的编译脚本：qmake / CMake </h3>
<p><code>qmake</code> 是 Qt 官方维护的成熟构建工具，但从 Qt 5.15 版本开始，官方推荐使用 <code>CMake</code> 作为默认的构建工具。</p>
<h4 id="示例testpro-文件"><strong>示例：<a href="http://Test.pro">Test.pro</a> 文件</strong> </h4>
<pre data-role="codeBlock" data-info="ini" class="language-ini ini"><code><span class="token key attr-name">TEMPLATE</span> <span class="token punctuation">=</span> <span class="token value attr-value">app</span>
<span class="token key attr-name">CONFIG +</span><span class="token punctuation">=</span> <span class="token value attr-value">console c++11</span>
<span class="token key attr-name">CONFIG -</span><span class="token punctuation">=</span> <span class="token value attr-value">app_bundle</span>
<span class="token key attr-name">CONFIG -</span><span class="token punctuation">=</span> <span class="token value attr-value">qt</span>

<span class="token key attr-name">SOURCES +</span><span class="token punctuation">=</span> <span class="token value attr-value">\</span>
        main.cpp
</code></pre><h3 id="qt-的版本控制系统">Qt 的版本控制系统 </h3>
<p>推荐使用 <strong>Git</strong> 进行版本控制。在实际开发中，每个开发人员通常有各自的分工，合理的 Git 流程可以减少代码冲突，提高协作效率。</p>
<h3 id="c-中的头文件">C++ 中的头文件 </h3>
<ul>
<li>头文件主要用于<strong>声明</strong>（declaration）。</li>
<li>源文件（.cpp）主要用于<strong>定义和实现</strong>（definition &amp; implementation）。</li>
</ul>
<h3 id="c-中的命名空间">C++ 中的命名空间 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
</code></pre><p>这行代码会将整个 <code>std</code> 标准库暴露在源代码中。一般推荐使用具体引用，例如：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">;</span>
</code></pre><p>这样可以避免命名冲突，提高代码的可读性。</p>
<h3 id="c-中的编译-链接-运行">C++ 中的编译、链接、运行 </h3>
<p>在 C++ 开发过程中，程序的构建主要包括以下几个阶段：</p>
<ol>
<li>
<p><strong>构建（Build）</strong></p>
<ul>
<li><strong>预处理</strong>：处理 <code>#include</code> 头文件，展开宏定义。</li>
<li><strong>编译</strong>：将每个 <code>.cpp</code> 或 <code>.c</code> 文件编译成 <code>.o</code>（目标文件），这些目标文件是二进制格式的编译单元。</li>
<li><strong>链接</strong>：将所有 <code>.o</code> 目标文件链接在一起，生成 <code>.exe</code> 可执行文件。</li>
</ul>
</li>
<li>
<p><strong>运行（Run）</strong></p>
<ul>
<li>运行编译好的可执行文件，执行程序逻辑。</li>
</ul>
</li>
</ol>
<h2 id="day2-c语法和工程实践20250306">Day2 C++语法和工程实践（2025.03.06） </h2>
<hr>
<h3 id="c中的内置类型">C++中的内置类型 </h3>
<p>C++ 提供了一系列内置数据类型，用于存储不同类型的值。常见的内置类型包括：</p>
<h4 id="1-基本数据类型">1. 基本数据类型 </h4>
<ul>
<li><strong>整数类型</strong>：
<ul>
<li><code>int</code>：用于存储整数，大小通常为 4 字节（具体大小依赖于系统）。</li>
<li><code>short</code>：较小的整数类型，通常为 2 字节。</li>
<li><code>long</code>：较大的整数类型，通常为 4 或 8 字节。</li>
<li><code>long long</code>：更大的整数类型，通常为 8 字节。</li>
</ul>
</li>
<li><strong>字符类型</strong>：
<ul>
<li><code>char</code>：用于存储字符，通常为 1 字节。</li>
<li><code>wchar_t</code>：用于存储宽字符（Unicode 字符），通常为 2 或 4 字节。</li>
</ul>
</li>
<li><strong>浮点类型</strong>：
<ul>
<li><code>float</code>：用于存储单精度浮点数，通常为 4 字节。</li>
<li><code>double</code>：用于存储双精度浮点数，通常为 8 字节。</li>
<li><code>long double</code>：用于存储更高精度的浮点数，大小依赖于系统，通常为 10 或 12 字节。</li>
</ul>
</li>
</ul>
<h4 id="2-布尔类型">2. 布尔类型 </h4>
<ul>
<li><strong><code>bool</code></strong>：用于存储布尔值，取值为 <code>true</code> 或 <code>false</code>，通常为 1 字节。</li>
</ul>
<h4 id="3-空类型">3. 空类型 </h4>
<ul>
<li><strong><code>void</code></strong>：表示没有类型，常用于函数返回类型或指针声明。</li>
</ul>
<h4 id="4-类型限定符">4. 类型限定符 </h4>
<ul>
<li><strong><code>const</code></strong>：常量类型，表示变量的值不可修改。</li>
<li><strong><code>volatile</code></strong>：表示变量可能会被外部因素修改，告诉编译器避免优化。</li>
<li><strong><code>mutable</code></strong>：允许即使在 <code>const</code> 成员函数中也可以修改类的某些成员变量。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//C++内置类型</span>
<span class="token comment">//int char float double</span>
<span class="token keyword keyword-void">void</span> <span class="token function">builtin_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-bool">bool</span> a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//1个字节 布尔型</span>

	<span class="token keyword keyword-char">char</span> b<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1个字节 字符型</span>
	<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> c<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1个字节</span>

	<span class="token keyword keyword-short">short</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2个字节 短整型</span>
	<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-short">short</span> d1<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2个字节	</span>

	<span class="token keyword keyword-int">int</span> e<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4个字节 整型</span>
	<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> f<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4个字节</span>

	<span class="token keyword keyword-long">long</span> g<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//4个字节 长整型</span>
	<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> h<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4个字节	</span>

	<span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span> i<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8个字节 长长整型</span>
	<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span> j<span class="token punctuation">;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8个字节</span>

	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token comment">//str指向的内容不能改变</span>
	<span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4个字节 指针的大小 32位系统4个字节 64位系统8个字节 C语言字符串以'\0'结尾 1个字节</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token comment">//5个字节</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> str1 <span class="token operator">=</span> <span class="token string">"xxx"</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token comment">//"xxx"是一个字符串常量，占用4个字节 因为C语言字符串以'\0'结尾 1个字节</span>


  <span class="token comment">//数组</span>
	<span class="token comment">//定义：类型 数组名[元素个数] = {元素1, 元素2, ...};</span>
	<span class="token keyword keyword-int">int</span> arr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//40个字节</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token comment">//40个字节</span>
	<span class="token comment">//不用new[]分配的数组是栈上的数组，编译时就确定了数组的大小，也就是要求个数必须是常量（已知的）</span>
	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> aa <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> a_stack_arr<span class="token punctuation">[</span>aa<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//40个字节</span>
	<span class="token comment">//访问数组元素（第一个值）</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">//1</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>arr <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">//1</span>
	<span class="token comment">//访问第二个值</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> a_stack_arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>		<span class="token comment">//2</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token punctuation">(</span>a_stack_arr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">//2</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">builtin_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="c中的自定义类型">C++中的自定义类型 </h3>
<p>C++ 允许开发者定义自定义类型，以便构建更复杂的程序结构。常见的自定义类型包括：</p>
<h4 id="1-类class">1. 类（Class） </h4>
<p>类是面向对象编程（OOP）中最常见的自定义类型，允许开发者定义对象的属性和方法。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> age<span class="token punctuation">;</span>

    <span class="token comment">// 构造函数</span>
    <span class="token function">Person</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string n<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> a<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">age</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello, my name is "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" and I am "</span> <span class="token operator">&lt;&lt;</span> age <span class="token operator">&lt;&lt;</span> <span class="token string">" years old."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-结构体struct">2. 结构体（Struct） </h4>
<p>结构体与类相似，但结构体的成员默认是公共的，且通常用于存储数据。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> a<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> b<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-枚举enum">3. 枚举（Enum） </h4>
<p>枚举用于表示一组常量值，通常用于有限的离散值。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-enum">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span> RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE <span class="token punctuation">}</span><span class="token punctuation">;</span>
Color color <span class="token operator">=</span> GREEN<span class="token punctuation">;</span>
</code></pre><h4 id="4-类型别名type-aliases">4. 类型别名（Type Aliases） </h4>
<p>C++ 允许使用 <code>typedef</code> 或 <code>using</code> 为现有类型创建别名，使代码更易读。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> ulong<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> uint <span class="token operator">=</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">;</span>
</code></pre><h4 id="5-模板template">5. 模板（Template） </h4>
<p>模板允许定义类型参数化的函数或类，使代码更加通用。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
T <span class="token function">add</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="左值右值">左值/右值 </h3>
<p>在 C++ 中，<strong>左值（Lvalue）</strong> 和 <strong>右值（Rvalue）</strong> 是两个重要的概念，它们与表达式的求值位置和类型紧密相关。</p>
<h4 id="1-左值lvalue">1. 左值（Lvalue） </h4>
<p>左值表示可以出现在赋值语句左侧的对象，它表示一个可以被修改的内存位置。</p>
<ul>
<li><strong>左值的特点</strong>：
<ul>
<li>有持久的内存地址，可以取地址（<code>&amp;</code>）。</li>
<li>可以作为赋值的目标。</li>
<li>示例：变量、数组元素、解引用指针等。</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>  <span class="token comment">// a 是一个左值</span>
</code></pre><h4 id="2-右值rvalue">2. 右值（Rvalue） </h4>
<p>右值表示没有持久内存地址的对象，通常是表达式的临时值，不能作为赋值语句的左侧。</p>
<ul>
<li><strong>右值的特点</strong>：
<ul>
<li>没有明确的内存地址，通常是临时值。</li>
<li>右值可以被用来初始化左值。</li>
<li>示例：常量、临时对象、返回值等。</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token comment">// 20 + 30 是右值</span>
</code></pre><h4 id="3-左值引用与右值引用">3. 左值引用与右值引用 </h4>
<ul>
<li>
<p><strong>左值引用（Lvalue Reference）</strong>：绑定到左值，使用 <code>&amp;</code>。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref <span class="token operator">=</span> a<span class="token punctuation">;</span>  <span class="token comment">// 左值引用</span>
</code></pre></li>
<li>
<p><strong>右值引用（Rvalue Reference）</strong>：绑定到右值，使用 <code>&amp;&amp;</code>。右值引用允许移动语义，避免不必要的复制。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span><span class="token operator">&amp;&amp;</span> rref <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>  <span class="token comment">// 右值引用</span>
</code></pre></li>
<li>
<p><strong>普通引用/非常量引用/左值引用</strong>： 变量引用，只能引用左值</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref <span class="token operator">=</span> c<span class="token punctuation">;</span>  <span class="token comment">// 左值引用</span>
</code></pre></li>
<li>
<p><strong>常量引用</strong> ：可以引用左值和右值</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> c <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> crc <span class="token operator">=</span> c<span class="token punctuation">;</span>  <span class="token comment">// 左值引用</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> crc2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// 右值引用</span>
</code></pre></li>
</ul>
<h4 id="4-重要概念">4. 重要概念 </h4>
<ul>
<li><strong>完美转发（Perfect Forwarding）</strong>：通过右值引用和 <code>std::forward</code> 可以将传递给函数的参数“完美”转发给另一个函数，保持其值类别（左值或右值）。</li>
<li><strong>移动语义（Move Semantics）</strong>：通过右值引用，C++ 可以“移动”资源，而不是复制，减少不必要的内存分配和提高性能。</li>
</ul>
<hr>
<h3 id="指针引用">指针/引用 </h3>
<p>在 C++ 中，<strong>指针（Pointer）</strong> 和 <strong>引用（Reference）</strong> 是两个用于间接访问变量的强大工具。它们在内存管理、函数参数传递、动态分配和面向对象编程中起着重要作用。下面是它们的详尽比较和使用方法：</p>
<hr>
<h4 id="-1-指针pointer">📌 1. 指针（Pointer） </h4>
<h5 id="11-什么是指针">1.1 什么是指针？ </h5>
<ul>
<li>指针是一个变量，存储的是另一个变量的内存地址。</li>
<li>通过指针可以间接访问和修改该地址上的数据。</li>
</ul>
<h5 id="12-指针的语法">1.2 指针的语法 </h5>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> <span class="token comment">// p 是一个指向 a 的指针，&amp; 取 a 的地址</span>

std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a 的值: "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>       <span class="token comment">// 10</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a 的地址: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">&amp;</span>a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// 0x7ffeed5c (示例地址)</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"p 指针存储的地址: "</span> <span class="token operator">&lt;&lt;</span> p <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 0x7ffeed5c</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"通过 p 访问 a 的值: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>p <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 10</span>
</code></pre><h5 id="13-常见操作">1.3 常见操作 </h5>
<ul>
<li><strong>取地址符 <code>&amp;</code></strong>：获取变量的地址。</li>
<li><strong>解引用符 <code>*</code></strong>：通过指针访问（读取/修改）变量的值。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 修改 a 的值为 20</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a 的新值: "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre><h5 id="14-指针的种类">1.4 指针的种类 </h5>
<ul>
<li><strong>空指针（nullptr）</strong>：</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token comment">// 指针不指向任何有效地址</span>
</code></pre><ul>
<li><strong>野指针（Dangling Pointer）</strong>：</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span><span class="token operator">*</span> p<span class="token punctuation">;</span> <span class="token comment">// 未初始化的指针，指向未知内存，可能会引发未定义行为</span>
</code></pre><ul>
<li><strong>常量指针（指针常量）</strong>：</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> <span class="token comment">// p1 指向的值不能修改</span>
<span class="token keyword keyword-int">int</span><span class="token operator">*</span> <span class="token keyword keyword-const">const</span> p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>  <span class="token comment">// p2 本身的指向不能修改</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">*</span> <span class="token keyword keyword-const">const</span> p3 <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> <span class="token comment">// p3 指向和值都不能修改</span>
</code></pre><ul>
<li><strong>指针数组</strong> 和 <strong>数组指针</strong>：</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span><span class="token operator">*</span> pArr <span class="token operator">=</span> arr<span class="token punctuation">;</span> <span class="token comment">// 指针指向数组首元素</span>
<span class="token keyword keyword-int">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>pArray<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">;</span> <span class="token comment">// 数组指针，指向整个数组</span>
</code></pre><h5 id="15-动态内存分配">1.5 动态内存分配 </h5>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态分配内存并初始化为 10</span>
<span class="token keyword keyword-delete">delete</span> p<span class="token punctuation">;</span>             <span class="token comment">// 释放内存，避免内存泄漏</span>

<span class="token keyword keyword-int">int</span><span class="token operator">*</span> arr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 动态数组</span>
<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">;</span>          <span class="token comment">// 释放数组内存</span>
</code></pre><hr>
<h4 id="-2-引用reference">📌 2. 引用（Reference） </h4>
<h5 id="21-什么是引用">2.1 什么是引用？ </h5>
<ul>
<li>引用是一个变量的别名（Alias），创建后始终指向初始化的对象，无法更改。</li>
<li>使用 <code>&amp;</code> 符号定义，但与取地址操作不同。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// ref 是 a 的引用</span>

ref <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 相当于 a = 20</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a 的值: "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre><h5 id="22-引用的特点">2.2 引用的特点 </h5>
<ul>
<li><strong>必须初始化</strong>：引用在创建时必须绑定到一个有效变量。</li>
<li><strong>不可更改绑定</strong>：引用绑定后无法更改指向其他变量。</li>
<li><strong>没有 <code>null</code> 引用</strong>：不存在空引用，必须总是绑定有效对象。</li>
<li><strong>不占用额外内存</strong>：引用本质上是变量的一个别名，不分配新内存。</li>
</ul>
<h5 id="23-常量引用">2.3 常量引用 </h5>
<ul>
<li><strong>保护数据不被修改</strong>，常用于函数参数传递中以避免复制大对象。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">showValue</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"值: "</span> <span class="token operator">&lt;&lt;</span> ref <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token function">showValue</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全，不会修改 a 的值</span>
</code></pre><hr>
<h4 id="-3-指针与引用的区别">📌 3. 指针与引用的区别 </h4>
<table>
<thead>
<tr>
<th>特性</th>
<th>指针（Pointer）</th>
<th>引用（Reference）</th>
</tr>
</thead>
<tbody>
<tr>
<td>初始化</td>
<td>可以不初始化（野指针）</td>
<td>必须初始化</td>
</tr>
<tr>
<td>重新绑定</td>
<td>可以指向不同地址</td>
<td>绑定后不可改变引用对象</td>
</tr>
<tr>
<td>是否为空</td>
<td>可以为 <code>nullptr</code></td>
<td>不能为 <code>null</code></td>
</tr>
<tr>
<td>内存占用</td>
<td>需要内存存储地址</td>
<td>不占用内存，作为别名存在</td>
</tr>
<tr>
<td>指针运算</td>
<td>支持算术运算 (如 <code>++</code>, <code>--</code>)</td>
<td>不支持指针运算</td>
</tr>
<tr>
<td>用途</td>
<td>动态分配、数组、函数指针、复杂数据结构</td>
<td>主要用于安全、简单的别名和参数传递</td>
</tr>
<tr>
<td>安全性</td>
<td>容易产生野指针、空指针问题</td>
<td>更安全，避免指针操作的风险</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="-4-指针和引用在函数中的应用">📌 4. 指针和引用在函数中的应用 </h4>
<h5 id="41-通过指针修改参数">4.1 通过指针修改参数 </h5>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token operator">*</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token function">modify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a = "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre><h5 id="42-通过引用修改参数">4.2 通过引用修改参数 </h5>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ref <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token function">modify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a = "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 30</span>
</code></pre><h5 id="43-指针和引用的混合使用">4.3 指针和引用的混合使用 </h5>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> temp <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">;</span>
    <span class="token operator">*</span>a <span class="token operator">=</span> <span class="token operator">*</span>b<span class="token punctuation">;</span>
    <span class="token operator">*</span>b <span class="token operator">=</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">;</span>
    a <span class="token operator">=</span> b<span class="token punctuation">;</span>
    b <span class="token operator">=</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h4 id="-5-什么时候用指针什么时候用引用">📌 5. 什么时候用指针？什么时候用引用？ </h4>
<ul>
<li>
<p><strong>使用指针的场景</strong>：</p>
<ul>
<li>需要动态内存分配（例如 <code>new/delete</code>）。</li>
<li>需要修改指针的指向（例如链表、树结构）。</li>
<li>用于实现复杂数据结构（例如数组、函数指针、回调函数）。</li>
<li>指针数组或数组指针的操作。</li>
</ul>
</li>
<li>
<p><strong>使用引用的场景</strong>：</p>
<ul>
<li>用作函数参数，避免对象拷贝，提高效率（尤其是大对象）。</li>
<li>常量引用用于只读访问对象（例如 <code>const T&amp;</code>）。</li>
<li>简化语法（例如范围 <code>for</code> 循环、运算符重载）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="-6-小结">🎯 6. 小结 </h4>
<ul>
<li><strong>指针</strong> 提供了灵活的内存操作能力，但容易出错，需要小心避免野指针、空指针、内存泄漏。</li>
<li><strong>引用</strong> 更安全、语法简洁，但缺乏指针的灵活性。</li>
<li>在实际项目中，优先使用引用，只有在需要指针特性时才使用指针，尤其是涉及动态分配和复杂数据结构时。</li>
</ul>
<hr>
<h3 id="优秀实践">优秀实践 </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>class MyClass;

MyClass test(const MyClass&amp; a,MyClass &amp;b)
{

}
</code></pre><p>好的做法是加const关键字的参数，通常是作为传入参数（只读），其他参数作为传出参数。</p>
<p>在 C++ 中，<strong>指针（Pointer）</strong> 和 <strong>引用（Reference）</strong> 是两个用于间接访问变量的强大工具。它们在内存管理、函数参数传递、动态分配和面向对象编程中起着重要作用。下面是它们的详尽比较和使用方法：</p>
<hr>
<h2 id="day3-移动语义和构造析构拷贝构造20250307">Day3 移动语义和构造/析构/拷贝构造（2025.03.07） </h2>
<hr>
<h3 id="进程的内存映像">进程的内存映像 </h3>
<p><img src="%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E6%98%A0%E5%83%8F-1.jpeg" alt="alt text"></p>
<h3 id="栈和堆">栈和堆 </h3>
<ul>
<li>栈：传递给函数的参数，是函数里面定义的，不通过malloc/new 分配的变量，都在栈上，对这些变量做拷贝是不计代价的。栈的内容和大小是已知的，编译时才确定。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//读文件的大小</span>
  <span class="token keyword keyword-int">int</span> size <span class="token operator">=</span> <span class="token function">getSizeofFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//分配堆内存</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** buf本身存放在栈上，buf指向的是堆内存*/</span>

	<span class="token comment">//把文件内容读到buf中</span>
	<span class="token function">readFileToBuf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//处理buf中的内容</span>
	<span class="token function">process</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//释放堆内存</span>
	<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ul>
<li>堆：编译时不知道，只有运行时才确定。堆是计量代价的，如果要使用堆内存，必须手动分配和手动回收，否则会造成内存泄漏。</li>
<li><em><strong>内存泄漏</strong></em>： 一直分配内存，但从不手动释放，就会造成操作系统无可用内存，new 分配的内存直到通过delete还给操作系统才会失效，而且使用delete后的内存是非法的。
<ul>
<li>内存泄露典型案例：在函数分配的堆内存赋给函数的局部变量，而忘记将该局部变量传出来，内存泄露发生在程序运行时，程序结束后，操作系统会回收所有程序的内存。所以内存泄漏往往在长期运行的服务器上发生。</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="C++" class="language-cpp C++"><code><span class="token keyword keyword-char">char</span><span class="token operator">*</span> flle <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//把堆内存还给操作系统</span>
<span class="token keyword keyword-delete">delete</span> file<span class="token punctuation">;</span>
file  <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
</code></pre><h3 id="new和malloc">new和malloc </h3>
<ul>
<li>new 一般是用malloc实现的</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>//C++风格
int* pInt <span class="token operator">=</span> new int<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>//100×4个字节
//C风格
int* pInt2 <span class="token operator">=</span> <span class="token punctuation">(</span>int*<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span><span class="token number">100</span> * sizeof<span class="token punctuation">(</span>int<span class="token punctuation">))</span><span class="token punctuation">;</span>//100×4个字节
</code></pre><h3 id="类和对象">类和对象 </h3>
<h4 id="1-类class-1">1. 类（Class） </h4>
<p>类是面向对象编程（OOP）中最常见的自定义类型，允许开发者定义对象的属性和方法。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> age<span class="token punctuation">;</span>

    <span class="token comment">// 构造函数</span>
    <span class="token function">Person</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string n<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> a<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">age</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello, my name is "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" and I am "</span> <span class="token operator">&lt;&lt;</span> age <span class="token operator">&lt;&lt;</span> <span class="token string">" years old."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>面试常见</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//MSVC</span>
<span class="token comment">//指针： 8字节</span>
<span class="token comment">//总长度 4字节/8字节</span>
<span class="token comment">//使用长度 4字节/8字节</span>

<span class="token comment">//GCC</span>
<span class="token comment">//指针： 8字节</span>
<span class="token comment">//指向末尾的指针 8字节</span>
<span class="token comment">//指向最后一个元素的指针 8字节</span>
</code></pre><h4 id="2-结构体struct-1">2. 结构体（Struct） </h4>
<p>结构体与类相似，但结构体的成员默认是公共的，且通常用于存储数据。</p>
<h2 id="day4-1-智能指针20250318">Day4-1 智能指针（2025.03.18） </h2>
<h3 id="智能指针的用法">智能指针的用法 </h3>
<h4 id="myclass类头文件">MyClass类头文件 </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//MyClass.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">MYCLASS_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MYCLASS_H</span></span>


<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
  <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-void">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
  <span class="token keyword keyword-int">int</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// MYCLASS_H</span></span>

</code></pre><pre data-role="codeBlock" data-info="" class="language-text"><code></code></pre><h4 id="myclass类实现文件">MyClass类实现文件 </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//MyClass.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MyClass.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> val<span class="token punctuation">)</span>
  <span class="token operator">:</span><span class="token function">value</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Constructor: "</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Destructor: "</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Value: "</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="主程序maincpp">主程序main.cpp </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"myclass.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token comment">//#include &lt;QApplication&gt;</span>

<span class="token comment">// 1️.尝试返回一个 std::unique_ptr&lt;MyClass&gt; 的函数</span>
std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> <span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 这样是安全的，返回临时 unique_ptr</span>
<span class="token punctuation">}</span>

<span class="token comment">// ❌ 错误示范（不能返回局部变量的 unique_ptr，否则会导致悬空指针）</span>
<span class="token comment">// std::unique_ptr&lt;MyClass&gt; createInvalidInstance() {</span>
<span class="token comment">//     std::unique_ptr&lt;MyClass&gt; ptr = std::make_unique&lt;MyClass&gt;(20);</span>
<span class="token comment">//     return ptr;  // ❌ 这样会尝试拷贝 unique_ptr，而 unique_ptr 不允许拷贝</span>
<span class="token comment">// }</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testuniqueptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr1 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建 unique_ptr</span>
  ptr1<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问成员函数</span>

  <span class="token comment">// std::unique_ptr&lt;MyClass&gt; ptr2 = ptr1; // ❌ 错误！unique_ptr 不支持拷贝</span>

  <span class="token comment">//std::unique_ptr&lt;MyClass&gt; ptr2 = std::move(ptr1);  // ✅ 使用 std::move 转移所有权</span>

  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ptr1<span class="token punctuation">)</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr1 is now nullptr"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">//ptr1失去所有权</span>

  <span class="token comment">// 3️⃣ 使用 createInstance() 返回 unique_ptr</span>
  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr3 <span class="token operator">=</span> <span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ptr3<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4️⃣ 使用 std::vector&lt;std::unique_ptr&lt;MyClass&gt;&gt; 存储多个 unique_ptr</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;&gt;</span>   myVector<span class="token punctuation">;</span>
  myVector<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myVector<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myVector<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vector Contentd"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> item <span class="token operator">:</span> myVector<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    item<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testsharedptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr1 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建 shared_ptr</span>
  <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr2 <span class="token operator">=</span> ptr1<span class="token punctuation">;</span>  <span class="token comment">// 共享 ptr1 的对象，引用计数+1</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr2 use count: "</span> <span class="token operator">&lt;&lt;</span> ptr2<span class="token punctuation">.</span><span class="token function">use_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    ptr2<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// 退出作用域，ptr2 释放，引用计数-1</span>

  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr3 <span class="token operator">=</span> ptr1<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr3 use count: "</span> <span class="token operator">&lt;&lt;</span> ptr3<span class="token punctuation">.</span><span class="token function">use_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  ptr3<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> ptr4 <span class="token operator">=</span> ptr1<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr4 use count: "</span> <span class="token operator">&lt;&lt;</span> ptr4<span class="token punctuation">.</span><span class="token function">use_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>


  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;&gt;</span> myVector2<span class="token punctuation">;</span>
  myVector2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myVector2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myVector2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vector Contentd"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> item <span class="token operator">:</span> myVector2<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    item<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  ptr3<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放 ptr3，引用计数 -1</span>
  ptr4<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放 ptr4，引用计数 -1</span>
  ptr1<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放 ptr1，引用计数 -1，此时应该调用析构函数</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr1 use count: "</span> <span class="token operator">&lt;&lt;</span> ptr1<span class="token punctuation">.</span><span class="token function">use_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

  <span class="token comment">// 程序结束，ptr1 释放，引用计数归 0，析构对象</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">A</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
  std<span class="token double-colon punctuation">::</span>weak_ptr<span class="token operator">&lt;</span>A<span class="token operator">&gt;</span> a_ptr<span class="token punctuation">;</span>  <span class="token comment">// ❗改成 weak_ptr</span>
  <span class="token operator">~</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B destroyed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>B<span class="token operator">&gt;</span> b_ptr<span class="token punctuation">;</span>
  <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"A destroyed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testweakptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>A<span class="token operator">&gt;</span> a <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>A<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>B<span class="token operator">&gt;</span> b <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>B<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  a<span class="token operator">-&gt;</span>b_ptr <span class="token operator">=</span> b<span class="token punctuation">;</span>  <span class="token comment">// A 持有 B</span>
  b<span class="token operator">-&gt;</span>a_ptr <span class="token operator">=</span> a<span class="token punctuation">;</span>  <span class="token comment">// B **弱引用** A（不会增加计数）</span>

  <span class="token comment">//return 0之后 A 和 B 都会被正确释放</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

	<span class="token comment">//testuniqueptr();</span>

	<span class="token comment">//testsharedptr();</span>
  
	<span class="token function">testweakptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  
  <span class="token comment">//return a.exec();</span>
<span class="token punctuation">}</span>

</code></pre><h2 id="day4-2移动构造函数和移动赋值运算符-c20250319">Day4-2移动构造函数和移动赋值运算符 (C++)（2025.03.19） </h2>
<p>本主题介绍如何为 C++ 类编写<em>移动构造函数</em>和移动赋值运算符。 移动构造函数使右值对象拥有的资源无需复制即可移动到左值中。 有关移动语义的详细信息，请参阅 <a href="https://learn.microsoft.com/zh-cn/cpp/cpp/rvalue-reference-declarator-amp-amp?view=msvc-170">Rvalue 引用声明符：&amp;&amp;</a>。</p>
<p>此主题基于用于管理内存缓冲区的 C++ 类 <code>MemoryBlock</code>。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// MemoryBlock.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MemoryBlock</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>

   <span class="token comment">// Simple constructor that initializes the resource.</span>
   <span class="token keyword keyword-explicit">explicit</span> <span class="token function">MemoryBlock</span><span class="token punctuation">(</span>size_t length<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">_length</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
      <span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In MemoryBlock(size_t). length = "</span>
                <span class="token operator">&lt;&lt;</span> _length <span class="token operator">&lt;&lt;</span> <span class="token string">"."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Destructor.</span>
   <span class="token operator">~</span><span class="token function">MemoryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In ~MemoryBlock(). length = "</span>
                <span class="token operator">&lt;&lt;</span> _length <span class="token operator">&lt;&lt;</span> <span class="token string">"."</span><span class="token punctuation">;</span>

      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_data <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
         std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Deleting resource."</span><span class="token punctuation">;</span>
         <span class="token comment">// Delete the resource.</span>
         <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Copy constructor.</span>
   <span class="token function">MemoryBlock</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> MemoryBlock<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">_length</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>_length<span class="token punctuation">)</span>
      <span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">[</span>other<span class="token punctuation">.</span>_length<span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In MemoryBlock(const MemoryBlock&amp;). length = "</span>
                <span class="token operator">&lt;&lt;</span> other<span class="token punctuation">.</span>_length <span class="token operator">&lt;&lt;</span> <span class="token string">". Copying resource."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

      std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>_data<span class="token punctuation">,</span> other<span class="token punctuation">.</span>_data <span class="token operator">+</span> _length<span class="token punctuation">,</span> _data<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Copy assignment operator.</span>
   MemoryBlock<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> MemoryBlock<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In operator=(const MemoryBlock&amp;). length = "</span>
                <span class="token operator">&lt;&lt;</span> other<span class="token punctuation">.</span>_length <span class="token operator">&lt;&lt;</span> <span class="token string">". Copying resource."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
         <span class="token comment">// Free the existing resource.</span>
         <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span>

         _length <span class="token operator">=</span> other<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>
         _data <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">[</span>_length<span class="token punctuation">]</span><span class="token punctuation">;</span>
         std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>_data<span class="token punctuation">,</span> other<span class="token punctuation">.</span>_data <span class="token operator">+</span> _length<span class="token punctuation">,</span> _data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Retrieves the length of the data resource.</span>
   size_t <span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
   <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span> _length<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
   size_t _length<span class="token punctuation">;</span> <span class="token comment">// The length of the resource.</span>
   <span class="token keyword keyword-int">int</span><span class="token operator">*</span> _data<span class="token punctuation">;</span> <span class="token comment">// The resource.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>以下过程介绍如何为示例 C++ 类编写移动构造函数和移动赋值运算符。</p>
<h3 id="为-c-创建移动构造函数">为 C++ 创建移动构造函数 </h3>
<ol>
<li>
<p>定义一个空的构造函数方法，该方法采用一个对类类型的右值引用作为参数，如以下示例所示：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token function">MemoryBlock</span><span class="token punctuation">(</span>MemoryBlock<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span>
   <span class="token operator">:</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
   <span class="token punctuation">,</span> <span class="token function">_length</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>在移动构造函数中，将源对象中的类数据成员添加到要构造的对象：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>_data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span>
_length <span class="token operator">=</span> other<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p>将源对象的数据成员分配给默认值。 这可以防止析构函数多次释放资源（如内存）:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>other<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
other<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<h3 id="为-c-类创建移动赋值运算符">为 C++ 类创建移动赋值运算符 </h3>
<ol>
<li>
<p>定义一个空的赋值运算符，该运算符采用一个对类类型的右值引用作为参数并返回一个对类类型的引用，如以下示例所示：</p>
<p>C++复制</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>MemoryBlock<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>MemoryBlock<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>在移动赋值运算符中，如果尝试将对象赋给自身，则添加不执行运算的条件语句。</p>
<p>C++复制</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>在条件语句中，从要将其赋值的对象中释放所有资源（如内存）。</p>
<p>以下示例从要将其赋值的对象中释放 <code>_data</code> 成员：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Free the existing resource.</span>
<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span>
</code></pre><p>执行第一个过程中的步骤 2 和步骤 3 以将数据成员从源对象转移到要构造的对象：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Copy the data pointer and its length from the</span>
<span class="token comment">// source object.</span>
_data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span>
_length <span class="token operator">=</span> other<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>

<span class="token comment">// Release the data pointer from the source object so that</span>
<span class="token comment">// the destructor does not free the memory multiple times.</span>
other<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
other<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p>返回对当前对象的引用，如以下示例所示：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<h3 id="示例完成移动构造函数和赋值运算符">示例：完成移动构造函数和赋值运算符 </h3>
<p>以下示例显示了 <code>MemoryBlock</code> 类的完整移动构造函数和移动赋值运算符：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Move constructor.</span>
<span class="token function">MemoryBlock</span><span class="token punctuation">(</span>MemoryBlock<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
   <span class="token operator">:</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
   <span class="token punctuation">,</span> <span class="token function">_length</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In MemoryBlock(MemoryBlock&amp;&amp;). length = "</span>
             <span class="token operator">&lt;&lt;</span> other<span class="token punctuation">.</span>_length <span class="token operator">&lt;&lt;</span> <span class="token string">". Moving resource."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

   <span class="token comment">// Copy the data pointer and its length from the</span>
   <span class="token comment">// source object.</span>
   _data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span>
   _length <span class="token operator">=</span> other<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>

   <span class="token comment">// Release the data pointer from the source object so that</span>
   <span class="token comment">// the destructor does not free the memory multiple times.</span>
   other<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
   other<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Move assignment operator.</span>
MemoryBlock<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>MemoryBlock<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
<span class="token punctuation">{</span>
   std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In operator=(MemoryBlock&amp;&amp;). length = "</span>
             <span class="token operator">&lt;&lt;</span> other<span class="token punctuation">.</span>_length <span class="token operator">&lt;&lt;</span> <span class="token string">"."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

   <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      <span class="token comment">// Free the existing resource.</span>
      <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span>

      <span class="token comment">// Copy the data pointer and its length from the</span>
      <span class="token comment">// source object.</span>
      _data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span>
      _length <span class="token operator">=</span> other<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>

      <span class="token comment">// Release the data pointer from the source object so that</span>
      <span class="token comment">// the destructor does not free the memory multiple times.</span>
      other<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
      other<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="示例-使用移动语义来提高性能">示例 使用移动语义来提高性能 </h3>
<p>以下示例演示移动语义如何能提高应用程序的性能。 此示例将两个元素添加到一个矢量对象，然后在两个现有元素之间插入一个新元素。 <code>vector</code> 类使用移动语义，通过移动矢量元素（而非复制它们）来高效地执行插入操作。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// rvalue-references-move-semantics.cpp</span>
<span class="token comment">// compile with: /EHsc</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MemoryBlock.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token comment">// Create a vector object and add a few elements to it.</span>
   vector<span class="token operator">&lt;</span>MemoryBlock<span class="token operator">&gt;</span> v<span class="token punctuation">;</span>
   v<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">MemoryBlock</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   v<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">MemoryBlock</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// Insert a new element into the second position of the vector.</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">MemoryBlock</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>该示例产生下面的输出：</p>
<pre data-role="codeBlock" data-info="Output" class="language-output Output"><code>In MemoryBlock(size_t). length = 25.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 25. Moving resource.
In ~MemoryBlock(). length = 0.
In MemoryBlock(size_t). length = 75.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 75. Moving resource.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 25. Moving resource.
In ~MemoryBlock(). length = 0.
In ~MemoryBlock(). length = 0.
In MemoryBlock(size_t). length = 50.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 50. Moving resource.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 25. Moving resource.
In MemoryBlock(MemoryBlock&amp;&amp;). length = 75. Moving resource.
In ~MemoryBlock(). length = 0.
In ~MemoryBlock(). length = 0.
In ~MemoryBlock(). length = 0.
In ~MemoryBlock(). length = 25. Deleting resource.
In ~MemoryBlock(). length = 50. Deleting resource.
In ~MemoryBlock(). length = 75. Deleting resource.
</code></pre><p>在 Visual Studio 2010 之前，此示例生成了以下输出：</p>
<pre data-role="codeBlock" data-info="Output" class="language-output Output"><code>In MemoryBlock(size_t). length = 25.
In MemoryBlock(const MemoryBlock&amp;). length = 25. Copying resource.
In ~MemoryBlock(). length = 25. Deleting resource.
In MemoryBlock(size_t). length = 75.
In MemoryBlock(const MemoryBlock&amp;). length = 25. Copying resource.
In ~MemoryBlock(). length = 25. Deleting resource.
In MemoryBlock(const MemoryBlock&amp;). length = 75. Copying resource.
In ~MemoryBlock(). length = 75. Deleting resource.
In MemoryBlock(size_t). length = 50.
In MemoryBlock(const MemoryBlock&amp;). length = 50. Copying resource.
In MemoryBlock(const MemoryBlock&amp;). length = 50. Copying resource.
In operator=(const MemoryBlock&amp;). length = 75. Copying resource.
In operator=(const MemoryBlock&amp;). length = 50. Copying resource.
In ~MemoryBlock(). length = 50. Deleting resource.
In ~MemoryBlock(). length = 50. Deleting resource.
In ~MemoryBlock(). length = 25. Deleting resource.
In ~MemoryBlock(). length = 50. Deleting resource.
In ~MemoryBlock(). length = 75. Deleting resource.
</code></pre><p>使用移动语义的此示例版本比不使用移动语义的版本更高效，因为前者执行的复制、内存分配和内存释放操作更少。</p>
<h3 id="可靠编程">可靠编程 </h3>
<p>若要防止资源泄漏，请始终释放移动赋值运算符中的资源（如内存、文件句柄和套接字）。</p>
<p>若要防止不可恢复的资源损坏，请正确处理移动赋值运算符中的自我赋值。</p>
<p>如果为你的类同时提供了移动构造函数和移动赋值运算符，则可以编写移动构造函数来调用移动赋值运算符，从而消除冗余代码。 以下示例显示了调用移动赋值运算符的移动构造函数的修改后的版本：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Move constructor.</span>
<span class="token function">MemoryBlock</span><span class="token punctuation">(</span>MemoryBlock<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
   <span class="token operator">:</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
   <span class="token punctuation">,</span> <span class="token function">_length</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><a href="https://learn.microsoft.com/zh-cn/cpp/standard-library/utility-functions?view=msvc-170#move">std::move</a> 函数将左值 <code>other</code> 转换为右值。</p>
<h2 id="day4-3-c四大函数构造拷贝构造析构赋值运算符函数20250319">Day4-3 C++四大函数（构造/拷贝构造/析构/赋值运算符函数）（2025.03.19） </h2>
<h3 id="point类">Point类 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Point</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> ix <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Point()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//拷贝构造函数</span>
	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Point<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_iy<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(const Point&amp;)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//问题1：拷贝构造函数中的引用符号能不能去掉？</span>
	<span class="token comment">//问题2：拷贝构造函数中的const关键字能不能去掉？</span>

	<span class="token comment">//解答1：去掉引用符号，会导致无穷递归调用，直到栈溢出（满足拷贝构造函数的调用时机1：形参与实参结合）</span>
	<span class="token comment">//解答2：去掉const关键字，会导致无法传递右值，即无法传递临时对象</span>

	<span class="token comment">//左值和右值</span>
	<span class="token keyword keyword-int">int</span> number <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref <span class="token operator">=</span> number<span class="token punctuation">;</span><span class="token comment">//左值引用</span>

	<span class="token comment">//int&amp; ref1 = 10;//错误，不能将右值赋值给左值引用</span>
	<span class="token keyword keyword-int">int</span><span class="token operator">&amp;&amp;</span> ref2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//右值引用</span>
	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span><span class="token operator">&amp;</span> ref3 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//常量左值引用</span>


	<span class="token comment">//赋值运算符函数</span>
	Point<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Point<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point&amp; operator=(const Point&amp;)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			_ix <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span>
			_iy <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_iy<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix
			<span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy
			<span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> _ix<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> _iy<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword keyword-class">class</span> <span class="token class-name">Line</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Line</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x1<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y1<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> x2<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y2<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pt1</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token comment">//如果不显示调用构造函数，会调用默认构造函数，所以最好可以显示初始化子对象</span>
		<span class="token punctuation">,</span> <span class="token function">_pt2</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//cout &lt;&lt; "Line(int,int,int,int)" &lt;&lt; endl;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//问题：为什么没有定义析构函数，也没有调用析构函数，就能释放资源？</span>
	<span class="token comment">// 定义析构函数</span>
	<span class="token operator">~</span><span class="token function">Line</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Line()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		_pt1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"----&gt;"</span><span class="token punctuation">;</span>
		_pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	Point _pt1<span class="token punctuation">;</span>
	Point _pt2<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Line <span class="token function">line</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	line<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Point pt<span class="token punctuation">;</span><span class="token comment">//栈对象</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pt = "</span><span class="token punctuation">;</span>
	pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Point* p = new Point();//堆对象</span>

	Point <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//栈对象</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pt2 = "</span><span class="token punctuation">;</span>
	pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Point pt3 <span class="token operator">=</span> pt2<span class="token punctuation">;</span><span class="token comment">//拷贝构造函数</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pt3 = "</span><span class="token punctuation">;</span>
	pt3<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Point <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Point <span class="token function">pt3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pt3 = "</span><span class="token punctuation">;</span>
	pt3<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> pt3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Point pt4 <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pt4 = "</span><span class="token punctuation">;</span>
	pt4<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"begin test..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//test();</span>

	<span class="token comment">//test1();</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"end test..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"sizeof(Point)= "</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Point<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token function">testLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="computer类">Computer类 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//Computer.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Computer</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span><span class="token keyword keyword-float">float</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Computer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Computer <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Computer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//静态成员函数void printTotalPrice();</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span>
	<span class="token keyword keyword-float">float</span> _price<span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-float">float</span> _totalPrice<span class="token punctuation">;</span><span class="token comment">//静态数据成员</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre><p>实现文件</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Computer.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CRT_SECURE_NO_WARNINGS</span></span>

<span class="token keyword keyword-float">float</span> Computer<span class="token double-colon punctuation">::</span>_totalPrice <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>

<span class="token comment">/*
1.	构造函数：
•	Computer(const char* brand, float price)：分配内存并复制品牌字符串。
2.	拷贝构造函数：
•	Computer(const Computer&amp; rhs)：分配新内存并复制 rhs 的品牌字符串，而不是简单地复制指针。
3.	析构函数：
•	~Computer()：释放分配的内存。
*/</span>
<span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> price<span class="token punctuation">)</span>
  <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computer(const char*,float)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  <span class="token function">strcpy_s</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span>

	_totalPrice <span class="token operator">+=</span> _price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//Computer::Computer(const Computer&amp; rhs) </span>
<span class="token comment">//  : _brand(rhs._brand)  // 浅拷贝</span>
<span class="token comment">//  , _price(rhs._price)</span>

<span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Computer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
  <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 深拷贝</span>
  <span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_price<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computer(const Computer&amp;)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  <span class="token function">strcpy_s</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制内容</span>
<span class="token punctuation">}</span>

<span class="token comment">/*赋值运算符函数中需要关注的几个问题*/</span>
<span class="token comment">//赋值运算符函数参数中的引用符号能不能去掉？</span>
<span class="token comment">//赋值运算符函数参数中的const关键字能不能去掉？</span>
<span class="token comment">//赋值运算符函数返回类型中的引用能不能去掉？</span>
<span class="token comment">//赋值运算符函数的返回类型可以不是对象吗？</span>

<span class="token comment">//解答1：在形参与实参结合的时候，会多执行一次拷贝构造函数</span>
<span class="token comment">//解答2：去掉const关键字，会导致无法传递右值，即无法传递临时对象</span>
<span class="token comment">//解答3：函数的返回类型是类类型的时候，会满足拷贝构造函数的调用条件</span>
<span class="token comment">//解答4：返回类型可以不是对象，但是会导致无法连续赋值 pc3 = pc2 = pc1</span>
Computer Computer<span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Computer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// TODO: 在此处插入 return 语句</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computer&amp; operator=(const Computer&amp;)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token comment">// 防止自复制 pc = pc</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>
		_brand <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_price <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">//_brand = rhs._brand;// 浅拷贝</span>
	<span class="token comment">//_price = rhs._price;// 浅拷贝</span>
	<span class="token comment">/*
  * 问题1：两个指针指向同一块内存，当其中一个对象释放内存后，另一个对象的指针就变成了野指针（double free）
	* 例如：pc2 = pc；pc2析构释放内存后，pc的析构函数再次释放内存，导致double free
  */</span>
  
	<span class="token comment">//double free 的解决办法：使用深拷贝</span>

	<span class="token comment">/*
  * 问题2：两个指针指向同一块内存，当其中一个对象释放内存后，另一个对象的指针就变成了悬空指针（dangling pointer）
  * pc2改变指针指向之后，原来pc2指向的那块堆内存就找不到了
  */</span>

	<span class="token comment">//内存泄漏的解决办法：delete[] _brand; _brand = new char[strlen(rhs._brand) + 1](); strcpy(_brand, rhs._brand);</span>
	<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Computer()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	_totalPrice <span class="token operator">-=</span> _price<span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>
		_brand <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 这里可以实现设置品牌的逻辑</span>
  <span class="token comment">// 释放旧的品牌内存</span>
  <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>
  <span class="token comment">// 分配新内存并复制品牌</span>
  _brand <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcpy_s</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword keyword-void">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> price<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 这里可以实现设置价格的逻辑</span>
	_price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"print()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"print() const"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"total price:"</span> <span class="token operator">&lt;&lt;</span> _totalPrice <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testStaticMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"购买第一台电脑前的总价："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"lenovo"</span><span class="token punctuation">,</span> <span class="token number">5555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"购买第一台电脑后的总价："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"购买第二台电脑后的总价："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testCopyConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"lenovo"</span><span class="token punctuation">,</span> <span class="token number">5555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/*pc.setBrand("ThinkPad");
  pc.setPrice(8888);*/</span>
  pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Computer pc2 <span class="token operator">=</span> pc<span class="token punctuation">;</span>
  pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-void">void</span> <span class="token function">testAssignmentOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"lenovo"</span><span class="token punctuation">,</span> <span class="token number">5555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pc: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pc2: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc2 <span class="token operator">=</span> pc<span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pc2: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  pc2 <span class="token operator">=</span> <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token string">"lenovo"</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testConst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//const对象只能调用const成员函数，非const对象可以调用任意成员函数</span>
	<span class="token keyword keyword-const">const</span> Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"lenovo"</span><span class="token punctuation">,</span> <span class="token number">5555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">//testCopyConstructor();</span>

	<span class="token comment">//testAssignmentOperator();</span>

	<span class="token comment">//testStaticMember();</span>

	<span class="token function">testConst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><hr>
<h2 id="day4-4-new-与-delete-表达式20250320">Day4-4 New 与 delete 表达式（2025.03.20） </h2>
<p>在 C++ 中，<code>new</code> 和 <code>delete</code> 是用于动态内存管理的关键字。它们分别用于在堆上分配和释放对象或数组。</p>
<h3 id="1-new-表达式的三个步骤">1. <code>new</code> 表达式的三个步骤 </h3>
<ol>
<li>
<p><strong>调用 <code>operator new</code> 标准库函数</strong></p>
<ul>
<li><code>operator new</code> 负责在堆上申请一块原始的、未初始化的内存空间，以便存储对象。</li>
<li>如果申请失败，会抛出 <code>std::bad_alloc</code> 异常（除非使用 <code>nothrow</code> 版本的 <code>new</code>）。</li>
</ul>
</li>
<li>
<p><strong>调用构造函数</strong></p>
<ul>
<li>在申请到的内存空间上调用构造函数，初始化对象的数据成员。</li>
</ul>
</li>
<li>
<p><strong>返回指针</strong></p>
<ul>
<li>返回指向新分配对象的指针，以供程序使用。</li>
</ul>
</li>
</ol>
<p>示例代码：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"A() constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~A() destructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    A<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> A<span class="token punctuation">;</span>  <span class="token comment">// 调用 operator new 申请内存 -&gt; 调用构造函数 -&gt; 返回指针</span>
    <span class="token keyword keyword-delete">delete</span> p<span class="token punctuation">;</span>      <span class="token comment">// 调用析构函数 -&gt; 调用 operator delete 释放内存</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="2-delete-表达式的两个步骤">2. <code>delete</code> 表达式的两个步骤 </h3>
<ol>
<li>
<p><strong>调用析构函数</strong></p>
<ul>
<li>在释放对象所占的内存前，先执行析构函数，以回收对象的数据成员所占用的资源（如动态分配的内存、文件句柄等）。</li>
</ul>
</li>
<li>
<p><strong>调用 <code>operator delete</code> 库函数</strong></p>
<ul>
<li>释放对象本身所占用的内存空间，使其可被重新分配。</li>
</ul>
</li>
</ol>
<p>示例代码：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>A<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> A<span class="token punctuation">;</span>
<span class="token keyword keyword-delete">delete</span> p<span class="token punctuation">;</span> <span class="token comment">// 先调用析构函数，再释放内存</span>
</code></pre><h3 id="3-new-与-delete">3. <code>new[]</code> 与 <code>delete[]</code> </h3>
<ul>
<li><code>new[]</code> 用于动态分配对象数组，必须使用 <code>delete[]</code> 释放。</li>
<li><code>delete</code> 只能释放单个对象，而 <code>delete[]</code> 释放的是整个数组。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>A<span class="token operator">*</span> arr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> A<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 申请 5 个对象的数组</span>

<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">;</span>       <span class="token comment">// 释放数组</span>
</code></pre><p>如果用 <code>delete</code> 释放 <code>new[]</code> 申请的数组，可能会导致未完全析构的对象泄漏。</p>
<hr>
<h2 id="day5-类的定义和关键字再探20250324">Day5 类的定义和关键字再探（2025.03.24） </h2>
<h3 id="1-c-关键字-const-static-extern">1. C++ 关键字 <code>const</code>、<code>static</code>、<code>extern</code> </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> global_a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// 只读常量</span>
<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> s_b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>      <span class="token comment">// 静态全局变量（仅限当前文件可见）</span>
<span class="token keyword keyword-extern">extern</span> <span class="token keyword keyword-int">int</span> SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>     <span class="token comment">// 外部变量（多个文件可共享）</span>
</code></pre><ul>
<li><code>const</code>：用于定义只读变量，防止意外修改。</li>
<li><code>static</code>：修饰局部变量时，延长变量生命周期，修饰全局变量时，限制其作用域。</li>
<li><code>extern</code>：用于声明外部变量，使其可以在多个文件中访问。</li>
</ul>
<p>示例：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> fun_c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 仅初始化一次，生命周期贯穿整个程序</span>
    fun_c<span class="token operator">++</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fun_c = "</span> <span class="token operator">&lt;&lt;</span> fun_c <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="2-类的定义circle-和-rect">2. 类的定义：Circle 和 Rect </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Circle</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_r</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Circle()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token operator">~</span><span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Circle()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> M_PI <span class="token operator">*</span> _r <span class="token operator">*</span> _r<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> _r<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>要点：</strong></p>
<ul>
<li><strong>构造函数（Constructor）：</strong> 负责初始化对象，可以带默认参数。</li>
<li><strong>析构函数（Destructor）：</strong> 负责清理资源，名称前带 <code>~</code>。</li>
<li><strong>成员函数（Member Function）：</strong> <code>const</code> 关键字保证不会修改对象数据。</li>
</ul>
<h3 id="3-完整代码">3. 完整代码 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USE_MATH_DEFINES</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token comment">//关键字</span>
<span class="token comment">//const</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> global_a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//static</span>
<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> s_b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//extern</span>
<span class="token keyword keyword-extern">extern</span> <span class="token keyword keyword-int">int</span> SIZE  <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//三者的用途：const 修饰常量，static 修饰全局变量，extern 修饰外部变量</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-int">int</span> local_v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> fun_c<span class="token punctuation">;</span><span class="token comment">//静态局部变量 可以延长变量的生命周期</span>
	fun_c<span class="token operator">++</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"local_v = "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> local_v <span class="token operator">&lt;&lt;</span> <span class="token string">" ,"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"fun_c = "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> fun_c <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义一个圆</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Circle</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Circle</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_r</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Circle(double r = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">Circle</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r<span class="token punctuation">,</span><span class="token keyword keyword-char">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_r</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_name</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Circle(double r = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token operator">~</span><span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Circle()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//setRadius</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">setRadius</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		_r <span class="token operator">=</span> r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> M_PI <span class="token operator">*</span> _r <span class="token operator">*</span> _r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-double">double</span> _r<span class="token punctuation">;</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//定义一个矩形</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Rect</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Rect</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_l</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_w</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rect(double l = 0, double w = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token operator">~</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Rect()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-double">double</span> _l<span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> _w<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Circle <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1.getRadius() = "</span> <span class="token operator">&lt;&lt;</span> c1<span class="token punctuation">.</span><span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1.getArea() = "</span> <span class="token operator">&lt;&lt;</span> c1<span class="token punctuation">.</span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Circle c2<span class="token punctuation">;</span>
	c2<span class="token punctuation">.</span><span class="token function">setRadius</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2.getRadius() = "</span> <span class="token operator">&lt;&lt;</span> c2<span class="token punctuation">.</span><span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2.getArea() = "</span> <span class="token operator">&lt;&lt;</span> c2<span class="token punctuation">.</span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token function">testCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h2 id="day5-1-运算符重载20250324">Day5-1 运算符重载（2025.03.24） </h2>
<h3 id="1-复数类-complex-及其运算符重载">1. 复数类 <code>Complex</code> 及其运算符重载 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Complex</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-friend">friend</span> Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_real</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_imag</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Complex</span><span class="token punctuation">(</span>_real <span class="token operator">-</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">,</span> _imag <span class="token operator">-</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 前置++</span>
        <span class="token operator">++</span>_real<span class="token punctuation">;</span>
        <span class="token operator">++</span>_imag<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 后置++</span>
        Complex <span class="token function">tmp</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _real<span class="token operator">++</span><span class="token punctuation">;</span>
        _imag<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _real <span class="token operator">+=</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">;</span>
        _imag <span class="token operator">+=</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> _real<span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> _imag<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h3 id="2-运算符重载的几种方式">2. 运算符重载的几种方式 </h3>
<ul>
<li>
<p><strong>成员函数重载</strong>（适用于 <code>+=</code>、<code>++</code>、<code>-</code>）：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span><span class="token punctuation">;</span>
Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>友元函数重载</strong>（适用于 <code>+</code>、<code>*</code>）：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-friend">friend</span> Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-friend">friend</span> Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<h3 id="3-关键区别">3. 关键区别 </h3>
<table>
<thead>
<tr>
<th>运算符</th>
<th>适用方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>普通函数</td>
<td>需要访问两个对象的数据，可用友元函数</td>
</tr>
<tr>
<td><code>-</code></td>
<td>成员函数</td>
<td>只需要访问当前对象数据</td>
</tr>
<tr>
<td><code>++</code></td>
<td>成员函数</td>
<td>影响当前对象，前置++返回引用，后置++返回值</td>
</tr>
<tr>
<td><code>*</code></td>
<td>友元函数</td>
<td>需要访问两个对象的数据</td>
</tr>
</tbody>
</table>
<p>示例代码：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Complex c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>总结：</strong></p>
<ul>
<li>友元函数适用于二元运算（如 <code>+</code>、<code>*</code>）。</li>
<li>成员函数适用于一元运算（如 <code>++</code>）和复合赋值运算（如 <code>+=</code>）。</li>
</ul>
<h3 id="4完整代码">4.完整代码 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;limits.h&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//复数</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Complex</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//Complex operator/(const Complex&amp; rhs) const;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">_real</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_imag</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(double r = 0, double i = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">getReal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _real<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">getImag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _imag<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//运算符重载之成员函数</span>
	Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> <span class="token function">Complex</span><span class="token punctuation">(</span>_real <span class="token operator">-</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">,</span> _imag <span class="token operator">-</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//自增运算符重载</span>
	Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//前置++</span>
	<span class="token punctuation">{</span>
		<span class="token operator">++</span>_real<span class="token punctuation">;</span>
		<span class="token operator">++</span>_imag<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//后置自增运算符重载</span>
	Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span> <span class="token comment">//后置++</span>
	<span class="token punctuation">{</span>
		Complex <span class="token function">tmp</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_real<span class="token operator">++</span><span class="token punctuation">;</span>
		_imag<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> tmp<span class="token punctuation">;</span><span class="token comment">//返回类型是一个临时对象，所以不适用引用类型</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//前置++和后置++的区别？</span>
	<span class="token comment">//解答：前置++返回是对象的引用，是左值可以取地址</span>
	<span class="token comment">//后置++返回的是局部对象，是右值不能取地址</span>
	
	<span class="token comment">//+=运算符重载</span>
	<span class="token comment">//复合赋值运算符重载，推荐以成员函数的形式重载</span>
	Complex<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		_real <span class="token operator">+=</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">;</span>
		_imag <span class="token operator">+=</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>



	<span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_imag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_imag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-double">double</span> _real<span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> _imag<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>	

<span class="token comment">//“operator + ”必须至少有一个类类型的形参</span>
<span class="token comment">//int operator+(int lhs, int rhs)</span>
<span class="token comment">//{</span>
<span class="token comment">//	//return _real + rhs;</span>
<span class="token comment">//}</span>

<span class="token comment">//运算符重载之普通函数</span>
Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-return">return</span> <span class="token function">Complex</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span><span class="token function">getReal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> rhs<span class="token punctuation">.</span><span class="token function">getReal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lhs<span class="token punctuation">.</span><span class="token function">getImag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> rhs<span class="token punctuation">.</span><span class="token function">getImag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//运算符重载之友元函数（推荐使用）</span>
Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-return">return</span> <span class="token function">Complex</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>_real <span class="token operator">*</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">-</span> lhs<span class="token punctuation">.</span>_imag <span class="token operator">*</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">,</span>
		lhs<span class="token punctuation">.</span>_real <span class="token operator">*</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">+</span> lhs<span class="token punctuation">.</span>_real <span class="token operator">*</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1 = "</span><span class="token punctuation">;</span>
	c1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2 = "</span><span class="token punctuation">;</span>	
	c2<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3 = c1 + c2 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1 = "</span><span class="token punctuation">;</span>
	c1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2 = "</span><span class="token punctuation">;</span>	
	c2<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">-</span> c2<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3 = c1 - c2 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1 = "</span><span class="token punctuation">;</span>
	c1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2 = "</span><span class="token punctuation">;</span>
	c2<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">*</span> c2<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3 = c1 * c2 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	c3 <span class="token operator">+=</span> c1<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3 += c1 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Complex <span class="token function">c3</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token operator">++</span>c3<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"++c3 = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	c3<span class="token operator">++</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c3++ = "</span><span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Complex <span class="token function">c4</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c4 = "</span><span class="token punctuation">;</span>
	c4<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	c4<span class="token operator">++</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c4++ = "</span><span class="token punctuation">;</span>
	c4<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"前置++返回是对象的引用，是左值可以取地址，后置++返回的是局部对象，是右值不能取地址"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span>  argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//test();</span>
	<span class="token comment">//test2();</span>
	<span class="token comment">//test3();</span>
	<span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h2 id="day5-2-文件io20250324">Day5-2 文件IO（2025.03.24） </h2>
<h3 id="1-缓冲区与刷新">1. 缓冲区与刷新 </h3>
<p>在C++的标准输入输出流 (<code>iostream</code>) 中，I/O 操作通常会涉及缓冲区，以提高效率。默认情况下，<code>cout</code> 采用缓冲模式，输出内容会暂存到缓冲区，只有在缓冲区满了或遇到某些特殊情况（如换行）时，数据才会被刷新到屏幕。</p>
<h4 id="11-常见的缓冲刷新方式">1.1 常见的缓冲刷新方式 </h4>
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cout &lt;&lt; endl;</code></td>
<td>输出换行并刷新缓冲区</td>
<td><code>cout &lt;&lt; "Hello" &lt;&lt; endl;</code></td>
</tr>
<tr>
<td><code>cout &lt;&lt; flush;</code></td>
<td>只刷新缓冲区，但不换行</td>
<td><code>cout &lt;&lt; "Hello" &lt;&lt; flush;</code></td>
</tr>
<tr>
<td><code>cout &lt;&lt; ends;</code></td>
<td>在缓冲区加入一个空字符（<code>\0</code>），但不会刷新</td>
<td><code>cout &lt;&lt; "Hello" &lt;&lt; ends;</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token char">'b'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 刷新缓冲区并换行</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c"</span> <span class="token operator">&lt;&lt;</span> flush<span class="token punctuation">;</span> <span class="token comment">// 只刷新，不换行</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"d"</span> <span class="token operator">&lt;&lt;</span> ends<span class="token punctuation">;</span>  <span class="token comment">// 只插入空字符，不刷新</span>

    this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="2-文件读写操作">2. 文件读写操作 </h3>
<p>C++标准库提供了 <code>&lt;fstream&gt;</code> 头文件，其中包含三个主要的文件流类：</p>
<table>
<thead>
<tr>
<th>类名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ifstream</code></td>
<td>读文件（input file stream）</td>
</tr>
<tr>
<td><code>ofstream</code></td>
<td>写文件（output file stream）</td>
</tr>
<tr>
<td><code>fstream</code></td>
<td>读写文件（file stream）</td>
</tr>
</tbody>
</table>
<h4 id="21-读取文件">2.1 读取文件 </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打开文件</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string line<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭文件</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="22-写入文件">2.2 写入文件 </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ofstream <span class="token function">ofs</span><span class="token punctuation">(</span><span class="token string">"output.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ofs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    ofs <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello, world!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="23-追加模式写入">2.3 追加模式写入 </h4>
<p>使用 <code>ios::app</code> 选项可以在文件末尾追加内容，而不会覆盖原有数据。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">appendToFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ofstream <span class="token function">ofs</span><span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ofs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ofs <span class="token operator">&lt;&lt;</span> <span class="token string">"新日志记录"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="23-完整代码">2.3 完整代码 </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件流读文件</span>
	<span class="token comment">//对于文件输入流而言，默认以空格作为分隔符</span>
	string line<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ifs <span class="token operator">&gt;&gt;</span> line<span class="token punctuation">)</span><span class="token comment">//cin &gt;&gt; line</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件流读文件</span>
	<span class="token comment">//对于文件输入流而言，默认以空格作为分隔符</span>
	string line<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//打印前几行的内容</span>
<span class="token keyword keyword-void">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件流读文件</span>
	<span class="token comment">//对于文件输入流而言，默认以空格作为分隔符</span>
	string line<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> lineNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		lineNum<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>lineNum <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//打印指定行的内容</span>
<span class="token keyword keyword-void">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	string fileName <span class="token operator">=</span> <span class="token string">"test.txt"</span><span class="token punctuation">;</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件流读文件</span>
	<span class="token comment">//对于文件输入流而言，默认以空格作为分隔符</span>
	string line<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	size_t lineNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> vec<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">[</span>lineNum<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">++</span>lineNum<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"line[22] = "</span> <span class="token operator">&lt;&lt;</span> line<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	string fileName <span class="token operator">=</span> <span class="token string">"test.txt"</span><span class="token punctuation">;</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件流读文件</span>
	<span class="token comment">//对于文件输入流而言，默认以空格作为分隔符</span>
	string line<span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> vec<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		vec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"vec[22] = "</span> <span class="token operator">&lt;&lt;</span> vec<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ifstream is not good!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	ofstream <span class="token function">ofs</span><span class="token punctuation">(</span><span class="token string">"wd.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ofs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ofstream is not good!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在程序异常退出时，关闭前面的ifs</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	string line<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ofs <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//对于文件的输出输出流而言，当文件不存在的时候就打开失败</span>
	fstream <span class="token function">fs</span><span class="token punctuation">(</span><span class="token string">"wenchang.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"fstream is not good!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//业务逻辑</span>
	<span class="token comment">//通过键盘输入数据,使用fs进行读文件，随后输出到屏幕</span>
	<span class="token keyword keyword-int">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请输入5次数字： "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">!=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cin <span class="token operator">&gt;&gt;</span> number<span class="token punctuation">;</span>
		fs <span class="token operator">&lt;&lt;</span> number <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t len <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">tellp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"len= "</span> <span class="token operator">&lt;&lt;</span> len <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	fs<span class="token punctuation">.</span><span class="token function">seekp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	len <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">tellp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"len= "</span> <span class="token operator">&lt;&lt;</span> len <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">!=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fs.failbit = "</span> <span class="token operator">&lt;&lt;</span> fs<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl
			<span class="token operator">&lt;&lt;</span> <span class="token string">"fs.eofbit = "</span> <span class="token operator">&lt;&lt;</span> fs<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl
			<span class="token operator">&lt;&lt;</span> <span class="token string">"fs.goodbit = "</span> <span class="token operator">&lt;&lt;</span> fs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		fs <span class="token operator">&gt;&gt;</span> number<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> number <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//追加模式</span>
<span class="token keyword keyword-void">void</span> <span class="token function">test8</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>in <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>ate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ifstream is not good!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ifs.tellg() = "</span> <span class="token operator">&lt;&lt;</span> ifs<span class="token punctuation">.</span><span class="token function">tellg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test9</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ofstream <span class="token function">ofs</span><span class="token punctuation">(</span><span class="token string">"wenchang.txt"</span><span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>out <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ofs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ofstream is not good!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ofs.tellg() = "</span> <span class="token operator">&lt;&lt;</span> ofs<span class="token punctuation">.</span><span class="token function">tellp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token comment">//test();</span>
	<span class="token comment">//test5(); //读取文件内容到vector容器中</span>
	<span class="token function">test9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><h3 id="3-文件定位操作">3. 文件定位操作 </h3>
<p>文件流支持 <code>seekg()</code>（get）和 <code>seekp()</code>（put）来定位文件指针。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">filePositioning</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    fstream <span class="token function">fs</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>in <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    fs<span class="token punctuation">.</span><span class="token function">seekg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移动到文件末尾</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件大小: "</span> <span class="token operator">&lt;&lt;</span> fs<span class="token punctuation">.</span><span class="token function">tellg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" 字节"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="4-字符串io">4. 字符串IO </h3>
<p>C++ 提供了 <code>stringstream</code> 以便在字符串中进行 I/O 操作。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">stringStreamDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    stringstream ss<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> num <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    ss <span class="token operator">&lt;&lt;</span> <span class="token string">"数字: "</span> <span class="token operator">&lt;&lt;</span> num<span class="token punctuation">;</span>
    string output <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> output <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="5-配置文件解析示例">5. 配置文件解析示例 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">readConfig</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> string<span class="token operator">&amp;</span> filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ifstream <span class="token function">ifs</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"打开文件失败: "</span> <span class="token operator">&lt;&lt;</span> filename <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string line<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        istringstream <span class="token function">iss</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        string key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
        iss <span class="token operator">&gt;&gt;</span> key <span class="token operator">&gt;&gt;</span> value<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> <span class="token string">" -&gt; "</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="6-完整代码">6. 完整代码 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span> <span class="token comment">// 添加此行以包含 ifstream 的定义</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>ostringstream<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>istringstream<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> std<span class="token double-colon punctuation">::</span>stringstream<span class="token punctuation">;</span>

string <span class="token function">int2string</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ostringstream oss<span class="token punctuation">;</span><span class="token comment">//中转</span>
	oss <span class="token operator">&lt;&lt;</span> value<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> oss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取底层的字符串</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span>  <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-int">int</span> number <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	string s1 <span class="token operator">=</span> <span class="token function">int2string</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"s1 = "</span> <span class="token operator">&lt;&lt;</span> s1 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-int">int</span> number1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> number2 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	stringstream ss<span class="token punctuation">;</span>
	ss <span class="token operator">&lt;&lt;</span> <span class="token string">"number1 = "</span> <span class="token operator">&lt;&lt;</span> number1
	 	<span class="token operator">&lt;&lt;</span> <span class="token string">"number2 = "</span> <span class="token operator">&lt;&lt;</span> number2<span class="token punctuation">;</span>
	string s1 <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"s1 ="</span> <span class="token operator">&lt;&lt;</span>  s1 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	string key<span class="token punctuation">;</span>
	string value<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ss <span class="token operator">&gt;&gt;</span> key <span class="token operator">&gt;&gt;</span> value<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> <span class="token string">"---&gt;"</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">readConfig</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> string<span class="token operator">&amp;</span> filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ifstream <span class="token function">ifs</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"open"</span> <span class="token operator">&lt;&lt;</span> filename <span class="token operator">&lt;&lt;</span> <span class="token string">"error!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	string line<span class="token punctuation">;</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ifs<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		istringstream <span class="token function">iss</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
		string key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
		iss <span class="token operator">&gt;&gt;</span> key <span class="token operator">&gt;&gt;</span> value<span class="token punctuation">;</span>

		 
		cout <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">readConfig</span><span class="token punctuation">(</span><span class="token string">"my.conf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="7-二进制文件操作">7. 二进制文件操作 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Data</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 写入二进制文件</span>
<span class="token keyword keyword-void">void</span> <span class="token function">writeBinaryFile</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> string <span class="token operator">&amp;</span>filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ofstream <span class="token function">ofs</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ofs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Data d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    ofs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 读取二进制文件</span>
<span class="token keyword keyword-void">void</span> <span class="token function">readBinaryFile</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> string <span class="token operator">&amp;</span>filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ifstream <span class="token function">ifs</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ifs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Data d<span class="token punctuation">;</span>
    ifs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-char">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"id: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token punctuation">.</span>id <span class="token operator">&lt;&lt;</span> <span class="token string">", value: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token punctuation">.</span>value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    string filename <span class="token operator">=</span> <span class="token string">"data.bin"</span><span class="token punctuation">;</span>
    <span class="token function">writeBinaryFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">readBinaryFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="总结">总结 </h3>
<ol>
<li><strong>文本文件</strong>
<ul>
<li><code>ifstream</code> 读取文件，<code>ofstream</code> 写入文件，<code>fstream</code> 读写文件。</li>
<li><code>seekg()</code> 和 <code>seekp()</code> 控制文件指针。</li>
<li><code>stringstream</code> 适用于字符串的 I/O 操作。</li>
<li><code>ios::app</code> 可用于追加模式写入文件。</li>
</ul>
</li>
<li><strong>二进制文件</strong>
<ul>
<li>读写方式：<code>ifstream</code>、<code>ofstream</code> 需使用 <code>ios::binary</code> 模式</li>
<li>读取方式：<code>read()</code> 和 <code>write()</code></li>
<li>适用于存储结构化数据，如 <code>struct</code> 类型的存储和读取。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="day6-1-输入输出流运算符重载20250325"><strong>Day6-1 输入输出流运算符重载（2025.03.25）</strong> </h2>
<pre data-role="codeBlock" data-info="plaintext" class="language-plaintext plaintext"><code>1. 拷贝构造函数的调用时机
2. 友元
   2.1 友元函数
3. 输入输出流运算符重载
   3.1 关键知识点
   3.2 代码
   3.3 关键问题
   3.4 完整代码
4. 下标访问运算符 `operator[]`
   4.1 关键知识点
   4.2 代码
5. 函数调用运算符 `operator()`
   5.1 关键知识点
   5.2 代码
   5.3 示例
   5.4 完整代码
6. 总结
</code></pre><hr>
<h3 id="1-回顾"><strong>1. 回顾</strong> </h3>
<h4 id="11-拷贝构造函数的调用时机"><strong>1.1 拷贝构造函数的调用时机</strong> </h4>
<p>拷贝构造函数在以下情况会被调用：</p>
<ol>
<li>
<p><strong>对象初始化</strong></p>
<ul>
<li>当用一个已经存在的对象去初始化一个刚刚创建的对象时，调用拷贝构造函数。</li>
<li>例：<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Complex c2 <span class="token operator">=</span> c1<span class="token punctuation">;</span> <span class="token comment">// 调用拷贝构造函数</span>
</code></pre></li>
</ul>
</li>
<li>
<p><strong>函数参数传递</strong></p>
<ul>
<li>当形参与实参都是对象时，在函数调用时会调用拷贝构造函数。</li>
<li>例：<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">func</span><span class="token punctuation">(</span>Complex c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token function">func</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 形参与实参结合时调用拷贝构造函数</span>
</code></pre></li>
</ul>
</li>
<li>
<p><strong>函数返回对象</strong></p>
<ul>
<li>当函数返回一个对象时，可能调用拷贝构造函数（但现代 C++ 编译器会尝试优化此过程，如返回值优化 RVO）。</li>
<li>例：<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Complex <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Complex <span class="token function">c</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> c<span class="token punctuation">;</span> <span class="token comment">// 可能调用拷贝构造函数</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-友元"><strong>2. 友元</strong> </h3>
<h4 id="21-友元函数"><strong>2.1 友元函数</strong> </h4>
<ul>
<li>友元函数可以访问类的私有成员。</li>
<li>友元声明可以出现在类的 <code>public</code>、<code>protected</code> 或 <code>private</code> 部分，不影响其权限。</li>
<li>友元关系是<strong>单向的、不可传递的</strong>：
<ul>
<li><strong>单向</strong>：如果 <code>A</code> 是 <code>B</code> 的友元，<code>B</code> 并不会自动成为 <code>A</code> 的友元。</li>
<li><strong>不可传递</strong>：如果 <code>A</code> 是 <code>B</code> 的友元，<code>B</code> 是 <code>C</code> 的友元，<code>A</code> 并不会自动成为 <code>C</code> 的友元。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-输入输出流运算符重载"><strong>3. 输入输出流运算符重载</strong> </h3>
<h4 id="31-关键知识点"><strong>3.1 关键知识点</strong> </h4>
<ol>
<li>
<p><strong><code>operator&lt;&lt;</code> 必须是友元函数</strong></p>
<ul>
<li>由于 <code>cout &lt;&lt; c1;</code> 左操作数是 <code>std::ostream</code>，不能修改 <code>std::ostream</code>，所以 <code>operator&lt;&lt;</code> 不能是 <code>Complex</code> 的成员函数。</li>
</ul>
</li>
<li>
<p><strong><code>operator&gt;&gt;</code> 不能是 <code>const</code> 成员函数</strong></p>
<ul>
<li>因为 <code>operator&gt;&gt;</code> 需要修改对象的值，因此不能加 <code>const</code>。</li>
</ul>
</li>
</ol>
<h4 id="32-代码"><strong>3.2 代码</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请输入复数的实部和虚部："</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    is <span class="token operator">&gt;&gt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&gt;&gt;</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="33-关键问题"><strong>3.3 关键问题</strong> </h4>
<ul>
<li>
<p><strong>为什么 <code>operator&lt;&lt;</code> 和 <code>operator&gt;&gt;</code> 的返回值是 <code>std::ostream&amp;</code> 和 <code>std::istream&amp;</code> ？</strong></p>
<ul>
<li>这样可以实现<strong>连续输入输出</strong>：<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>cout <span class="token operator">&lt;&lt;</span> c1 <span class="token operator">&lt;&lt;</span> c2 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>  <span class="token comment">// 连续输出</span>
cin <span class="token operator">&gt;&gt;</span> c1 <span class="token operator">&gt;&gt;</span> c2<span class="token punctuation">;</span>           <span class="token comment">// 连续输入</span>
</code></pre></li>
</ul>
</li>
<li>
<p><strong>为什么 <code>operator&lt;&lt;</code> 的 <code>ostream&amp;</code> 参数不能去掉 <code>&amp;</code> ？</strong></p>
<ul>
<li>因为 <code>ostream</code> 的拷贝构造函数已被 <code>delete</code>，不能复制 <code>ostream</code> 对象。</li>
</ul>
</li>
</ul>
<h4 id="34-完整代码"><strong>3.4 完整代码</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;limits.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//复数</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Complex</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> Complex <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//Complex operator/(const Complex&amp; rhs) const;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_real</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_imag</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(double r = 0, double i = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	

	<span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>

		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_imag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_imag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//成员函数，operator输出运算符重载 </span>
	<span class="token comment">//cout &lt;&lt; c1 &lt;&lt; endl; </span>
	<span class="token comment">//第一个参数cout ,第二个参数c1</span>
	<span class="token comment">//std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const Complex&amp; rhs); //error！隐含this指针</span>

	<span class="token comment">//对于输出流运算符函数而言，不能写成成员函数的形式，因为违背了运算符重载的原则，不能改变操作数的顺序</span>
	<span class="token comment">//std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os);//error！this指针在参数列表的第一个位置</span>

	

		<span class="token comment">/*友元函数可以放在类的 任何位置（public / protected / private），不影响其功能。
		从代码规范角度，建议统一放在类定义的开头或结尾，以提高可读性。
		友元关系是单向的，且不具备传递性（即类 A 的友元函数不会自动成为类 B 的友元）。
		*/</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//输入流运算符重载</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-double">double</span> _real<span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> _imag<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//问题1 ：参数列表中ostrream的引用符号&amp;能不能去掉？</span>
<span class="token comment">//解答1 ：不能去掉因为形参"os"和实参"cout"结合的时候会满足拷贝构造函数的调用时机，但是ostream中的拷贝构造函数已被delete</span>

<span class="token comment">//问题2 ： 函数返回类型中的引用符号&amp;能不能删除？</span>
<span class="token comment">//解答2 ： 不能取掉，因为return os，返回类型满足拷贝构造函数的调用时机3</span>

<span class="token comment">//注释：basic_ifstream( const basic_ifstream&amp; rhs ) = delete; (7)	(since C++11)</span>
<span class="token comment">//	   basic_ofstream( const basic_ofstream&amp; rhs ) = delete; (7)	(since C++11)</span>
<span class="token comment">//ifstram 和 ofstream 的拷贝构造函数已经从C++11开始删除了</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const Complex&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span>
	<span class="token punctuation">{</span>
		os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span>rhs<span class="token punctuation">.</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">readDouble</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>is <span class="token operator">&gt;&gt;</span> rhs<span class="token punctuation">,</span> <span class="token operator">!</span>is<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">bad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"istream is bad"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			is<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重置流的状态</span>
			is<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span><span class="token double-colon punctuation">::</span>std<span class="token double-colon punctuation">::</span>streamsize<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空缓冲区</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请注意：需要输入double类型的数据！"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span>
		<span class="token punctuation">{</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"rhs = "</span> <span class="token operator">&lt;&lt;</span> rhs <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//输入流运算符重载</span>
std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token comment">//因为要修改rhs 的值，所以不能加const</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"std::istream&amp; operator&gt;&gt;(std::istream&amp; is, Complex&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请分别输入复数的实部和虚部："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//is &gt;&gt; rhs._real &gt;&gt; rhs._imag;</span>
	<span class="token function">readDouble</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_real<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">readDouble</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-void">void</span> <span class="token function">testOutputOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1 = "</span><span class="token punctuation">;</span>
	c1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>


	<span class="token comment">//cout &lt;&lt; "c1 = " &lt;&lt; c1.display();</span>
	<span class="token comment">//为什么没有做输出流运算符重载之前上面的写法 不可行呢？ 解答：二元“&lt;&lt;”: 没有找到接受“void”类型的右操作数的运算符(或没有可接受的转换)</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c1 = "</span> <span class="token operator">&lt;&lt;</span> c1 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Complex c2<span class="token punctuation">;</span>
	cin <span class="token operator">&gt;&gt;</span> c2<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c2 = "</span> <span class="token operator">&lt;&lt;</span> c2 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">testOutputOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="4-下标访问运算符-operator"><strong>4. 下标访问运算符 <code>operator[]</code></strong> </h3>
<h4 id="41-关键知识点"><strong>4.1 关键知识点</strong> </h4>
<ul>
<li><code>operator[]</code> 主要用于自定义数组类型，使得 <code>obj[idx]</code> 访问数组元素。</li>
<li>返回值应为 <code>T&amp;</code>，以保证能够修改数组内容。</li>
<li>必须进行越界检查，以防止访问非法内存。</li>
</ul>
<h4 id="42-代码"><strong>4.2 代码</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-char">char</span><span class="token operator">&amp;</span> CharArrar<span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> _data<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-char">char</span> charNull <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> charNull<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-函数调用运算符-operator"><strong>5. 函数调用运算符 <code>operator()</code></strong> </h3>
<h4 id="51-关键知识点"><strong>5.1 关键知识点</strong> </h4>
<ul>
<li>使对象像函数一样调用，称为<strong>仿函数（函数对象）</strong>。</li>
<li>可存储状态，例如调用次数。</li>
</ul>
<h4 id="52-代码"><strong>5.2 代码</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">FunctionObject</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>_cnt<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-int">int</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>_cnt<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> y <span class="token operator">*</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> _cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="53-示例"><strong>5.3 示例</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>FunctionObject fo<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fo(3, 4) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">fo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fo(3, 4, 5) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">fo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre><h4 id="54-完整代码"><strong>5.4 完整代码</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//bracket.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">CharArrar</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">CharArrar</span><span class="token punctuation">(</span>size_t sz <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_size</span><span class="token punctuation">(</span>sz<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span>_size<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">" CharArrar(size_t sz = 10)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">CharArrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~CharArrar()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_data<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span> _data<span class="token punctuation">;</span>
			_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _size<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//下标访问运算符的重载</span>
	<span class="token comment">//int arr[10] = { 1,2,3,4,5 };</span>
	<span class="token comment">//arr.operator[](idx);</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	size_t _size<span class="token punctuation">;</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><hr>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//bracket.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bracket.h"</span></span>

<span class="token comment">/*
要修复错误 C2106: “=”: 左操作数必须为左值，需要确保 CharArrar 类的
下标运算符 operator[] 返回一个可修改的左值。当前的 operator[] 声明
返回的是一个 char，这不是一个可修改的左值。我们需要将其修改为返回一个 char&amp;。
*/</span>
<span class="token keyword keyword-char">char</span><span class="token operator">&amp;</span> CharArrar<span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t idx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _data<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-char">char</span> charNUll <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span><span class="token comment">//静态变量延长生命周期</span>
		<span class="token keyword keyword-return">return</span> charNUll<span class="token punctuation">;</span>   <span class="token comment">//使得返回的实体生命周期比函数的生命周期长</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//C++中优势：重载的下标访问运算符考虑了越界的问题</span>
<span class="token comment">//引用什么时候需要加上？</span>
<span class="token comment">//1.如果返回类型是类型的时候，可以减少拷贝构造函数的执行</span>
<span class="token comment">//2.有可能需要一个左值（来调用右操作数），而不是拷贝后的右值、</span>
<span class="token comment">//3.cout &lt;&lt; "111" &lt;&lt; c1 &lt;&lt; endl &lt;&lt; 10 &lt;&lt; 1 &lt;&lt; endl,像这种情况下连续使用的时候可以加上引用 </span>
</code></pre><hr>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//parenthese.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">FunctionObject</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
	

	<span class="token keyword keyword-int">int</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> _cnt<span class="token punctuation">;</span><span class="token comment">//记录被调用的次数（函数对象状态）</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><hr>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>parenthese<span class="token punctuation">.</span>cpp
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"parenthese.h"</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>



<span class="token keyword keyword-int">int</span> <span class="token class-name">FunctionObject</span><span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token operator">++</span>_cnt<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"int operator()(int x, int y)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token class-name">FunctionObject</span><span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> z<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"int operator()(int x, int y,int z)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token operator">++</span>_cnt<span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> y <span class="token operator">*</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><hr>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bracket.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"parenthese.h"</span></span>


<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"int add(int x,int y)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token operator">++</span>cnt<span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-void">void</span> <span class="token function">testFunctionObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FunctionObject fo<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> c <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token comment">//fo本质上是一个对象，但是他的使用</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fo(a,b) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">fo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fo(a, b ,c) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">fo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//正经的函数</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"add(a, b) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testCharArrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	
	<span class="token comment">//把字符串中的内容拷贝到CharArray</span>
	<span class="token keyword keyword-const">const</span>  <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pstr <span class="token operator">=</span> <span class="token string">"hello cpp"</span><span class="token punctuation">;</span>
	CharArrar <span class="token function">ca</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>pstr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">!=</span> ca<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//ca[idx] = pstr[idx];</span>
		<span class="token comment">//上面和下面两条代码等价</span>
		ca<span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token operator">=</span> pstr<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">!=</span> ca<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> ca<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">testFunctionObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">testCharArrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span>  <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h2 id="day6-2-成员访问运算符重载20250325"><strong>Day6-2 成员访问运算符重载（2025.03.25）</strong> </h2>
<h2 id="1-复习"><strong>1. 复习</strong> </h2>
<p>在上一节中，我们学习了 C++ 中的 <strong>输入输出流运算符重载（<code>&lt;&lt;</code> 和 <code>&gt;&gt;</code>）</strong> 以及 <strong>下标运算符 <code>[]</code> 和函数调用运算符 <code>()</code></strong> 的重载。本节我们将重点学习 <strong>成员访问运算符（<code>-&gt;</code> 和 <code>*</code>）的重载</strong>。</p>
<hr>
<h2 id="2-成员访问运算符重载"><strong>2. 成员访问运算符重载</strong> </h2>
<p>C++ 允许用户自定义类的成员访问方式，其中 <code>-&gt;</code>（箭头运算符）和 <code>*</code>（解引用运算符）是最常见的运算符之一。它们通常用于模拟智能指针或多层指针访问。</p>
<h3 id="21-箭头运算符---重载"><strong>2.1 箭头运算符 (<code>-&gt;</code>) 重载</strong> </h3>
<h4 id="1-语法"><strong>(1) 语法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    B<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>作用</strong>：</p>
<ul>
<li>允许 <code>A</code> 类的对象 <strong>像指针一样访问 <code>B</code> 类的成员</strong>。</li>
<li>典型用途是在 <strong>封装指针</strong> 的类（如智能指针）中重载 <code>operator-&gt;</code>，使得用户无需手动解引用即可访问目标对象的成员。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ol>
<li><strong>返回值必须是一个指针或者引用</strong>，否则无法继续访问成员变量或函数。</li>
<li><strong>如果返回的是对象的引用</strong>，则可以实现多层 <code>-&gt;</code> 重载。</li>
<li><code>operator-&gt;</code> <strong>不能改变调用对象自身</strong>，因此通常 <strong>不应该声明为 <code>const</code> 成员函数</strong>。</li>
</ol>
<hr>
<h3 id="22-解引用运算符--重载"><strong>2.2 解引用运算符 (<code>*</code>) 重载</strong> </h3>
<h4 id="1-语法-1"><strong>(1) 语法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    B<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>作用</strong>：</p>
<ul>
<li>允许 <code>A</code> 类的对象 <strong>像指针一样进行解引用</strong>。</li>
<li>常见于智能指针的实现，使 <code>*ptr</code> 直接返回对象的引用，方便访问其成员。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ol>
<li><strong>返回值一般是引用</strong>（如 <code>B&amp;</code>），这样不会产生额外的拷贝。</li>
<li>适用于 <strong>封装指针</strong> 的类，如智能指针或代理类。</li>
</ol>
<hr>
<h2 id="3-代码分析"><strong>3. 代码分析</strong> </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Data</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data(int data = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Data()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-int">int</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _data<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> _data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">SecondLayer</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">SecondLayer</span><span class="token punctuation">(</span>Data<span class="token operator">*</span> pData<span class="token punctuation">)</span>
	<span class="token operator">:</span><span class="token function">_pData</span><span class="token punctuation">(</span>pData<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"SecondLayer(Data* pData)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//重载 -&gt; 运算符</span>
	Data<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> _pData<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//解引用重载运算符</span>
	Data<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span>_pData<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token operator">~</span><span class="token function">SecondLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~SecondLayer()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pData<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span> _pData<span class="token punctuation">;</span>
			_pData <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	Data<span class="token operator">*</span> _pData<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">ThirdLayer</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">ThirdLayer</span><span class="token punctuation">(</span>SecondLayer<span class="token operator">*</span> pSecond<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pSecond</span><span class="token punctuation">(</span>pSecond<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ThirdLayer(SecondLayer* pSecond)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//重载 -&gt; 运算符</span>
	SecondLayer<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span>_pSecond<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">ThirdLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~ThirdLayer()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pSecond<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span> _pSecond<span class="token punctuation">;</span>
			_pSecond <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	SecondLayer<span class="token operator">*</span> _pSecond<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/*Data* data = new Data(1);
	SecondLayer* second = new SecondLayer(data);
	ThirdLayer* third = new ThirdLayer(second);*/</span>

	SecondLayer <span class="token function">second</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//栈对象</span>
	<span class="token comment">//A类的对象调用B类的成员函数</span>
	<span class="token comment">/*cout &lt;&lt; "&amp;second : " &lt;&lt; &amp;second &lt;&lt; endl;
	cout &lt;&lt; "second.operator-&gt;() :" &lt;&lt; second.operator-&gt;() &lt;&lt; endl;*/</span>

	<span class="token comment">//  重载operator-&gt;  </span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"second.operator-&gt;()-&gt;getData() :"</span> <span class="token operator">&lt;&lt;</span> second<span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"second-&gt;getData() :"</span> <span class="token operator">&lt;&lt;</span> second<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token comment">//  重载operator* </span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"(*second).getData()"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token operator">*</span>second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>


	ThirdLayer <span class="token function">third</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">SecondLayer</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//栈对象</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"third-&gt;getData() : "</span> <span class="token operator">&lt;&lt;</span> third<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//还原</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"third.operator-&gt;().operator-&gt;()-&gt;getData()"</span> <span class="token operator">&lt;&lt;</span> third<span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> argc<span class="token punctuation">,</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="31-代码结构"><strong>3.1 代码结构</strong> </h3>
<p>上面的代码实现了一个 <strong>三层封装</strong> 的指针代理类，分别是：</p>
<ul>
<li><code>Data</code>：数据类，包含一个 <code>_data</code> 成员变量。</li>
<li><code>SecondLayer</code>：封装 <code>Data*</code> 指针，并重载 <code>operator-&gt;</code> 和 <code>operator*</code>。</li>
<li><code>ThirdLayer</code>：封装 <code>SecondLayer*</code> 指针，并重载 <code>operator-&gt;</code>。</li>
</ul>
<hr>
<h3 id="32-代码解析"><strong>3.2 代码解析</strong> </h3>
<h4 id="1-data-类"><strong>(1) <code>Data</code> 类</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Data</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Data</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data(int data = 0)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Data()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-int">int</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> _data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> _data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ul>
<li><code>Data</code> 类封装了一个 <code>int</code> 类型的数据 <code>_data</code>，提供了 <code>getData()</code> 方法用于获取数据值。</li>
<li>构造函数、析构函数用于跟踪对象的创建和销毁。</li>
</ul>
<hr>
<h4 id="2-secondlayer-类"><strong>(2) <code>SecondLayer</code> 类</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">SecondLayer</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">SecondLayer</span><span class="token punctuation">(</span>Data<span class="token operator">*</span> pData<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_pData</span><span class="token punctuation">(</span>pData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"SecondLayer(Data* pData)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重载 -&gt; 运算符</span>
    Data<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> _pData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 解引用运算符 *</span>
    Data<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span>_pData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">SecondLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~SecondLayer()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pData<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-delete">delete</span> _pData<span class="token punctuation">;</span>
            _pData <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    Data<span class="token operator">*</span> _pData<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ul>
<li><strong>封装 <code>Data*</code> 指针，并提供访问 <code>Data</code> 成员的方式</strong>。</li>
<li><code>operator-&gt;()</code> 返回 <code>_pData</code> 指针，使得 <code>SecondLayer</code> 对象 <strong>可以像指针一样使用 <code>-&gt;</code> 访问 <code>Data</code> 的方法</strong>。</li>
<li><code>operator*()</code> 返回 <code>_pData</code> 所指向的 <code>Data</code> 对象的引用，使 <code>*second</code> 直接返回 <code>Data</code> 对象。</li>
</ul>
<p><strong>示例：</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>SecondLayer <span class="token function">second</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> second<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>  <span class="token comment">// 等价于 second.operator-&gt;()-&gt;getData()</span>
cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token operator">*</span>second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 等价于 second.operator*().getData()</span>
</code></pre><hr>
<h4 id="3-thirdlayer-类"><strong>(3) <code>ThirdLayer</code> 类</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">ThirdLayer</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">ThirdLayer</span><span class="token punctuation">(</span>SecondLayer<span class="token operator">*</span> pSecond<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_pSecond</span><span class="token punctuation">(</span>pSecond<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ThirdLayer(SecondLayer* pSecond)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重载 -&gt; 运算符</span>
    SecondLayer<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span>_pSecond<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">ThirdLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~ThirdLayer()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pSecond<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-delete">delete</span> _pSecond<span class="token punctuation">;</span>
            _pSecond <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    SecondLayer<span class="token operator">*</span> _pSecond<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ul>
<li><code>ThirdLayer</code> 封装了 <code>SecondLayer*</code> 指针，并提供 <code>operator-&gt;()</code> 使其 <strong>可以像 <code>SecondLayer</code> 一样使用 <code>-&gt;</code> 访问 <code>Data</code> 的方法</strong>。</li>
<li><strong>实现两层 <code>-&gt;</code> 重载</strong>，使得 <code>ThirdLayer</code> 可以连续访问 <code>Data</code> 成员。</li>
</ul>
<p><strong>示例：</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>ThirdLayer <span class="token function">third</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">SecondLayer</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> third<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>  <span class="token comment">// 等价于 third.operator-&gt;().operator-&gt;()-&gt;getData()</span>
</code></pre><hr>
<h3 id="33-运行-test-方法"><strong>3.3 运行 <code>test()</code> 方法</strong> </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SecondLayer <span class="token function">second</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"second-&gt;getData() :"</span> <span class="token operator">&lt;&lt;</span> second<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"(*second).getData()"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token operator">*</span>second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    ThirdLayer <span class="token function">third</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">SecondLayer</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"third-&gt;getData() : "</span> <span class="token operator">&lt;&lt;</span> third<span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"third.operator-&gt;().operator-&gt;()-&gt;getData() : "</span> <span class="token operator">&lt;&lt;</span> third<span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>输出：</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Data(int data = 0)
SecondLayer(Data* pData)
second-&gt;getData() : 10
(*second).getData() : 10
Data(int data = 0)
SecondLayer(Data* pData)
ThirdLayer(SecondLayer* pSecond)
third-&gt;getData() : 30
third.operator-&gt;().operator-&gt;()-&gt;getData() : 30
~ThirdLayer()
~SecondLayer()
~Data()
~SecondLayer()
~Data()
</code></pre><ul>
<li><code>SecondLayer</code> 允许访问 <code>Data</code> 对象。</li>
<li><code>ThirdLayer</code> 允许访问 <code>SecondLayer</code>，最终可访问 <code>Data</code>。</li>
<li><strong>多层指针访问的代理模式生效</strong>，并且析构时正确释放了内存。</li>
</ul>
<hr>
<h2 id="4-总结"><strong>4. 总结</strong> </h2>
<table>
<thead>
<tr>
<th>运算符</th>
<th>作用</th>
<th>适用场景</th>
<th>返回值类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operator-&gt;()</code></td>
<td>允许对象像指针一样访问成员</td>
<td>智能指针、代理类</td>
<td>指针或引用</td>
</tr>
<tr>
<td><code>operator*()</code></td>
<td>允许对象像指针一样解引用</td>
<td>智能指针、代理类</td>
<td>引用</td>
</tr>
</tbody>
</table>
<p><strong>关键点：</strong></p>
<ol>
<li><strong><code>operator-&gt;()</code> 需要返回指针或引用</strong>，可以连续调用 <code>-&gt;</code>。</li>
<li><strong><code>operator*()</code> 需要返回对象的引用</strong>，避免拷贝，提高性能。</li>
<li><strong>适用于封装指针的类，如智能指针和代理类</strong>。</li>
</ol>
<p>本节学习了 <strong>成员访问运算符 <code>-&gt;</code> 和 <code>*</code> 的重载</strong>，掌握它们的用法可以更好地理解 <strong>智能指针</strong> 和 <strong>代理模式</strong>。</p>
<hr>
<h2 id="day6-3-类型转换函数和类域"><strong>Day6-3 类型转换函数和类域</strong> </h2>
<h3 id="1-类型转换函数type-conversion-functions"><strong>1. 类型转换函数（Type Conversion Functions）</strong> </h3>
<h4 id="11-概述"><strong>1.1 概述</strong> </h4>
<p><strong>类型转换函数</strong>用于将类的对象转换为其他类型，满足以下特点：</p>
<ul>
<li>是<strong>类的成员函数</strong>，不能是友元函数或非成员函数。</li>
<li><strong>没有参数列表</strong>（即必须是 <code>()</code> 空参数）。</li>
<li><strong>没有返回类型声明</strong>，即不能显式声明 <code>void</code> 或其他返回类型。</li>
<li><strong>使用 <code>return</code> 语句返回目标类型的变量</strong>。</li>
</ul>
<h4 id="12-代码示例"><strong>1.2 代码示例</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Complex</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> real <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> imag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>  
        <span class="token operator">:</span> <span class="token function">_real</span><span class="token punctuation">(</span>real<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_imag</span><span class="token punctuation">(</span>imag<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(int, int) 构造函数"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex 析构函数"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> _real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-int">int</span> <span class="token function">getReal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> _real<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">getImag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> _imag<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> _real<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> _imag<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 重载输出运算符，使 Complex 可以被 cout 直接输出</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_real <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_imag <span class="token operator">&lt;&lt;</span> <span class="token string">"i"</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Point</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Point<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int, int) 构造函数"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// **类型转换函数**</span>
    <span class="token keyword keyword-operator">operator</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"operator int()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> _x <span class="token operator">+</span> _y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-operator">operator</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"operator double()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> _y <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0.0</span> <span class="token operator">:</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_x<span class="token punctuation">)</span> <span class="token operator">/</span> _y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-operator">operator</span> <span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"operator Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Complex</span><span class="token punctuation">(</span>_x<span class="token punctuation">,</span> _y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Point 析构函数"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// **类型转换构造函数**</span>
    <span class="token keyword keyword-explicit">explicit</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span><span class="token function">getReal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span><span class="token function">getImag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(const Complex&amp;) 类型转换构造函数"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> _x<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> _y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 重载输出运算符，使 Point 可以被 cout 直接输出</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Point<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    os <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testTypeConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point pt: "</span> <span class="token operator">&lt;&lt;</span> pt <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> intValue <span class="token operator">=</span> pt<span class="token punctuation">;</span>  
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"转换为 int: "</span> <span class="token operator">&lt;&lt;</span> intValue <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword keyword-double">double</span> doubleValue <span class="token operator">=</span> pt<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"转换为 double: "</span> <span class="token operator">&lt;&lt;</span> doubleValue <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    Complex comValue <span class="token operator">=</span> pt<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"转换为 Complex: "</span> <span class="token operator">&lt;&lt;</span> comValue <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">testTypeConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="13-关键优化"><strong>1.3 关键优化</strong> </h4>
<p>✅ <strong>类型转换构造函数</strong>增加 <code>explicit</code>，防止隐式转换导致潜在错误。<br>
✅ <strong>类型转换函数</strong>添加 <code>const</code>，保证 <code>Point</code> 的成员变量不会被修改。<br>
✅ <strong><code>operator double()</code></strong> 处理 <code>_y == 0</code> 情况，避免除零异常。<br>
✅ <strong>优化 <code>Complex</code> 相关代码</strong>，消除 <code>friend</code> 冗余，提高可读性。</p>
<hr>
<h3 id="2-类域class-scope"><strong>2. 类域（Class Scope）</strong> </h3>
<h4 id="21-作用域-vs-可见域"><strong>2.1 作用域 vs 可见域</strong> </h4>
<ul>
<li><strong>作用域（Scope）</strong>：指变量在代码中的<strong>可访问范围</strong>，影响变量的解析方式。</li>
<li><strong>可见域（Visibility）</strong>：变量是否在当前上下文可见，受 <code>private</code>、<code>protected</code>、<code>public</code> 修饰符影响。</li>
<li><strong>作用域 ≥ 可见域</strong>，如果没有<strong>命名冲突</strong>，二者相等。</li>
</ul>
<hr>
<h4 id="22-代码示例"><strong>2.2 代码示例</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> globalNumber <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>  <span class="token comment">// **全局作用域变量**</span>

<span class="token keyword keyword-namespace">namespace</span> ceshi
<span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> namespaceNumber <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>  <span class="token comment">// **命名空间作用域**</span>

    <span class="token keyword keyword-class">class</span> <span class="token class-name">Test</span>
    <span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span><span class="token operator">:</span>
        <span class="token function">Test</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">number</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> number<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"局部变量 number: "</span> <span class="token operator">&lt;&lt;</span> number <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"成员变量 number: "</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>number <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"类作用域 number: "</span> <span class="token operator">&lt;&lt;</span> Test<span class="token double-colon punctuation">::</span>number <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"命名空间 ceshi::number: "</span> <span class="token operator">&lt;&lt;</span> ceshi<span class="token double-colon punctuation">::</span>namespaceNumber <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"全局变量 globalNumber: "</span> <span class="token operator">&lt;&lt;</span> <span class="token double-colon punctuation">::</span>globalNumber <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span><span class="token operator">:</span>
        <span class="token keyword keyword-int">int</span> number<span class="token punctuation">;</span>  <span class="token comment">// **类成员变量**</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">// namespace ceshi</span>

<span class="token keyword keyword-void">void</span> <span class="token function">testScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> localValue <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
    ceshi<span class="token double-colon punctuation">::</span>Test obj<span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>localValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">testScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="23-关键优化"><strong>2.3 关键优化</strong> </h4>
<p>✅ <strong>清晰划分不同作用域</strong>：全局作用域 <code>::</code>、命名空间 <code>ceshi::</code>、类作用域 <code>this-&gt;</code> 和 <code>Test::</code>。<br>
✅ <strong>增强 <code>print()</code> 方法输出格式</strong>，更直观理解变量的作用域。<br>
✅ <strong>消除不必要的析构函数</strong>，提升代码简洁性。<br>
✅ <strong>代码格式调整</strong>，增强可读性。</p>
<hr>
<h3 id="3-内部类nested-class"><strong>3. 内部类（Nested Class）</strong> </h3>
<p><strong>内部类</strong>（Nested Class）是指在一个类的定义内部再定义一个类。内部类在逻辑上属于外部类的一部分，但具有自己的作用域。</p>
<h4 id="31-内部类的定义"><strong>3.1 内部类的定义</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-class">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span> <span class="token comment">// 内部类</span>
    <span class="token keyword keyword-public">public</span><span class="token operator">:</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"This is Inner class"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Outer<span class="token double-colon punctuation">::</span>Inner obj<span class="token punctuation">;</span> <span class="token comment">// 创建内部类对象</span>
    obj<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>特点：</strong></p>
<ol>
<li>内部类的作用域受外部类的限制。</li>
<li>内部类的对象可以通过 <code>外部类::内部类</code> 的方式创建。</li>
<li>内部类可以访问外部类的 <code>public</code> 和 <code>protected</code> 成员，但不能直接访问 <code>private</code> 成员（除非使用 <code>friend</code> 关键字）。</li>
</ol>
<h4 id="32-访问外部类的-private-成员"><strong>3.2 访问外部类的 <code>private</code> 成员</strong> </h4>
<p>如果内部类需要访问外部类的 <code>private</code> 成员，可以将其声明为 <code>friend</code>。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> _data <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-class">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span><span class="token operator">:</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">display</span><span class="token punctuation">(</span>Outer<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Outer data: "</span> <span class="token operator">&lt;&lt;</span> obj<span class="token punctuation">.</span>_data <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Outer outerObj<span class="token punctuation">;</span>
    Outer<span class="token double-colon punctuation">::</span>Inner innerObj<span class="token punctuation">;</span>
    innerObj<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span>outerObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="33-静态内部类"><strong>3.3 静态内部类</strong> </h4>
<p>静态内部类不能访问外部类的非静态成员。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">StaticInner</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span><span class="token operator">:</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"This is a static inner class"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Outer<span class="token double-colon punctuation">::</span>StaticInner obj<span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="4-作用域运算符scope-resolution-operator-"><strong>4. 作用域运算符（Scope Resolution Operator <code>::</code>）</strong> </h3>
<p>作用域运算符 <code>::</code> 用于指定变量、函数或类所属的作用域，主要应用如下：</p>
<h4 id="41-访问全局变量"><strong>4.1 访问全局变量</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> number <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> number <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Local number: "</span> <span class="token operator">&lt;&lt;</span> number <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Global number: "</span> <span class="token operator">&lt;&lt;</span> <span class="token double-colon punctuation">::</span>number <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="42-访问命名空间内的变量"><strong>4.2 访问命名空间内的变量</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-namespace">namespace</span> A <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-namespace">namespace</span> B <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> value <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"A::value = "</span> <span class="token operator">&lt;&lt;</span> A<span class="token double-colon punctuation">::</span>value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B::value = "</span> <span class="token operator">&lt;&lt;</span> B<span class="token double-colon punctuation">::</span>value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="43-访问类的静态成员"><strong>4.3 访问类的静态成员</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> Demo<span class="token double-colon punctuation">::</span>data <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Static data: "</span> <span class="token operator">&lt;&lt;</span> Demo<span class="token double-colon punctuation">::</span>data <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-类型转换运算符type-casting-operators"><strong>5. 类型转换运算符（Type Casting Operators）</strong> </h3>
<p>C++ 提供了四种类型转换运算符：</p>
<ol>
<li><code>static_cast</code>：用于基本类型之间的转换。</li>
<li><code>dynamic_cast</code>：用于多态类型的安全转换。</li>
<li><code>const_cast</code>：用于去除 <code>const</code> 或 <code>volatile</code> 修饰符。</li>
<li><code>reinterpret_cast</code>：用于不同类型指针之间的转换。</li>
</ol>
<h4 id="51-static_cast-用法"><strong>5.1 <code>static_cast</code> 用法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">test_static_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-double">double</span> num <span class="token operator">=</span> <span class="token number">10.5</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> intNum <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Converted value: "</span> <span class="token operator">&lt;&lt;</span> intNum <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="52-dynamic_cast-用法"><strong>5.2 <code>dynamic_cast</code> 用法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived class"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test_dynamic_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Base<span class="token operator">*</span> basePtr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Derived<span class="token operator">*</span> derivedPtr <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>basePtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>derivedPtr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        derivedPtr<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-delete">delete</span> basePtr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="53-const_cast-用法"><strong>5.3 <code>const_cast</code> 用法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">test_const_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> num <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span><span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token generic-function"><span class="token function">const_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Modified value: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>ptr <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="54-reinterpret_cast-用法"><strong>5.4 <code>reinterpret_cast</code> 用法</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">test_reinterpret_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> num <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-char">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Reinterpreted value: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>ch <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="6-关键字-explicit-与类型转换"><strong>6. 关键字 <code>explicit</code> 与类型转换</strong> </h3>
<p>默认情况下，C++ 允许构造函数进行隐式类型转换，但 <code>explicit</code> 关键字可以禁止这种行为。</p>
<h4 id="61-隐式转换"><strong>6.1 隐式转换</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Demo(int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test_implicit_conversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Demo obj <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 隐式调用 Demo(int)</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="62-使用-explicit-禁止隐式转换"><strong>6.2 使用 <code>explicit</code> 禁止隐式转换</strong> </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-explicit">explicit</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Demo(int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test_explicit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Demo obj = 10; // 错误！隐式转换被禁止</span>
    Demo <span class="token function">obj</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 正确</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="7-总结"><strong>7. 总结</strong> </h3>
<ol>
<li><strong>内部类</strong> 是定义在另一个类内部的类，具有自己的作用域，并且可以是 <code>static</code>。</li>
<li><strong>作用域运算符 <code>::</code></strong> 用于访问不同作用域的变量或函数。</li>
<li><strong>类型转换运算符</strong> 提供更安全、可控的转换方式。</li>
<li><strong><code>explicit</code> 关键字</strong> 可以防止构造函数的隐式转换。</li>
</ol>
<h2 id="day7-1-智能指针雏形"><strong>Day7-1 智能指针雏形</strong> </h2>
<h3 id="1-独占语义和共享语义"><strong>1. 独占语义和共享语义</strong> </h3>
<h4 id="11-概述-1"><strong>1.1 概述</strong> </h4>
<h3 id="2-stdstring的实现"><strong>2. std::string的实现</strong> </h3>
<h4 id="21-概述"><strong>2.1 概述</strong> </h4>
<h3 id="3-移动语义"><strong>3. 移动语义</strong> </h3>
<h4 id="31-概述"><strong>3.1 概述</strong> </h4>
<hr>
<h2 id="day7-2-继承和多态"><strong>Day7-2 继承和多态</strong> </h2>
<h3 id="一-继承">一、继承 </h3>
<h4 id="1-继承的基础">1、继承的基础 </h4>
<p>面向对象的四大基本特征：抽象、封装、继承、多态。</p>
<p>动物：既有类。父类、基类</p>
<p>鸟：新类。子类、派生类</p>
<p>继承：从既有类产生新类的一个过程。</p>
<h4 id="2-继承的定义">2、继承的定义 </h4>
<pre data-role="codeBlock" data-info="C++" class="language-cpp C++"><code><span class="token keyword keyword-class">class</span> 子类<span class="token punctuation">(</span>派生类<span class="token punctuation">)</span> 
<span class="token operator">:</span> <span class="token keyword keyword-public">public</span><span class="token operator">/</span><span class="token keyword keyword-protected">protected</span><span class="token operator">/</span><span class="token keyword keyword-private">private</span> 父类<span class="token punctuation">(</span>基类<span class="token punctuation">)</span>   <span class="token comment">//类派生列表</span>
<span class="token punctuation">{</span>
    <span class="token comment">//数据成员</span>
    <span class="token comment">//成员函数</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-派生类产生的过程">3、派生类产生的过程 </h4>
<p>1、吸收基类的成员</p>
<p>2、改造基类的成员</p>
<p>3、添加自己新的成员</p>
<p>吸收、改造、新增。</p>
<h4 id="4-继承的局限">4、继承的局限 </h4>
<p>构造函数、析构函数、友元关系、基类的operator new/delete /=</p>
<h4 id="5-访问权限">5、访问权限 </h4>
<h4 id="6-protected与private继承区别">6、protected与private继承区别 </h4>
<p>1、protected的继承可以无限继承下去，但是private继承只能有一代</p>
<p>2、如果不写继承方式，默认继承方式是私有的。</p>
<h3 id="二-派生类对象的构造">二、派生类对象的构造 </h3>
<p>总结：<strong>当创建派生类对象的时候</strong>，<strong>会调用派生类的构造函数</strong>，为了完成从基类吸收过来的数据成员的初始化，会调用基类的构造函数，而如果基类没有显示定义构造函数，就会调用基类的无参构造函数，而如果基类有显示定义构造函数，那么也会默认调用基类的无参构造函数，完成初始化，如果不在派生类的构造函数的初始化列表中显示调用基类有参构造函数，就会报错。</p>
<p>总结：当创建派生类对象的时候，不管基类与派生类有没有显示写出构造函数，肯定默认会调用无参的，有时无参又没有，所以最好在派生类构造函数的初始化列表中，显示写出基类构造函数就可以。</p>
<p>派生类构造函数的功能：（执行顺序）</p>
<p>1、完成对象所占整块内存的开辟，由系统在调用构造函数时自动完成。<br>
2、调用基类的构造函数完成基类成员的初始化。<br>
3、若派生类中含对象成员、const成员或引用成员，则必须在初始化表中完成其初始化。<br>
4、派生类构造函数体执行</p>
<h3 id="三-派生类对象的销毁">三、派生类对象的销毁 </h3>
<p>派生类对象销毁的时候，会执行派生类的析构函数，然后<strong>基类析构函数会自动调用</strong>。</p>
<p>析构函数执行顺序：</p>
<p>1、先调用派生类的析构函数<br>
2、再调用派生类中成员对象的析构函数<br>
3、最后调用普通基类的析构函数</p>
<h3 id="四-多继承重要">四、多继承（重要） </h3>
<h4 id="1-多继承基础">1、多继承基础 </h4>
<h4 id="2-多继承的问题">2、多继承的问题 </h4>
<h5 id="1-成员函数访问冲突">1、成员函数访问冲突 </h5>
<p>解决方案：使用类名 + 作用域限定符</p>
<h5 id="2-数据成员的存储二义性">2、数据成员的存储二义性 </h5>
<p>解决方案：虚拟继承。</p>
<h2 id="day7-3-基类与派生类深入"><strong>Day7-3 基类与派生类深入</strong> </h2>
<h2 id="cday16">C++Day16 </h2>
<h3 id="一-问题回顾">一、问题回顾 </h3>
<p>1、继承的形式？三种继承方式的特点？派生类生成过程？继承局限？</p>
<p>2、派生类对象的创建的特点？销毁的特征？</p>
<p>3、多继承的问题有哪几种？如何解决？</p>
<h3 id="二-基类与派生类间的转换">二、基类与派生类间的转换 </h3>
<p><strong>类型适应</strong>：派生类对象可以适用于基类对象。一个类可以适用于另外一个类的所有场景。<br>
<img src="%E5%9F%BA%E7%B1%BB%E6%B4%BE%E7%94%9F%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2-1.png" alt="alt text"></p>
<hr>
<h3 id="关于-base-ref--derived-的推荐程度"><strong>关于 <code>Base&amp; ref = derived</code> 的推荐程度</strong> </h3>
<p>在C++中，<code>Base&amp; ref = derived</code>（基类引用绑定到派生类对象）是一种 <strong>推荐</strong> 的写法，但具体是否适用取决于你的需求。下面详细分析它的优缺点以及适用场景。</p>
<hr>
<h2 id="1-base--derived对象赋值发生切片"><strong>1. <code>base = derived</code>（对象赋值，发生切片）</strong> </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Base base <span class="token operator">=</span> derived<span class="token punctuation">;</span>  <span class="token comment">// 对象赋值，发生切片（slicing）</span>
base<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 调用 Base::print()</span>
</code></pre><h3 id="特点"><strong>特点：</strong> </h3>
<ul>
<li><strong>对象切片（Object Slicing）</strong>：<code>derived</code> 的派生类部分被丢弃，只保留 <code>Base</code> 部分，<code>base</code> 是一个全新的 <code>Base</code> 对象。</li>
<li><strong>不推荐</strong>：除非你明确只需要基类部分，否则通常应该避免这种写法，因为它丢失了派生类的信息。</li>
</ul>
<hr>
<h2 id="2-base-ref--derived引用绑定无切片"><strong>2. <code>Base&amp; ref = derived</code>（引用绑定，无切片）</strong> </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> derived<span class="token punctuation">;</span>  <span class="token comment">// 引用绑定，无切片</span>
ref<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 如果 print() 是虚函数，调用 Derived::print()</span>
</code></pre><h3 id="特点-1"><strong>特点：</strong> </h3>
<p>✅ <strong>优点：</strong></p>
<ol>
<li><strong>无对象切片</strong>：<code>ref</code> 只是 <code>derived</code> 的基类部分的引用，不会复制数据，派生类信息仍然完整。</li>
<li><strong>支持多态</strong>：如果 <code>Base::print()</code> 是 <code>virtual</code> 的，调用 <code>ref.print()</code> 会正确调用 <code>Derived::print()</code>（动态绑定）。</li>
<li><strong>更高效</strong>：避免了不必要的拷贝（特别是当 <code>Base</code> 较大时）。</li>
</ol>
<p>❌ <strong>缺点：</strong></p>
<ol>
<li><strong>只能访问基类成员</strong>：通过 <code>ref</code> 无法直接访问 <code>Derived</code> 的特有方法（如 <code>derived.extra()</code>）。</li>
<li><strong>必须确保 <code>derived</code> 的生命周期</strong>：如果 <code>derived</code> 被销毁，<code>ref</code> 会变成悬空引用（dangling reference），导致未定义行为（UB）。</li>
</ol>
<hr>
<h2 id="3-推荐程度"><strong>3. 推荐程度</strong> </h2>
<table>
<thead>
<tr>
<th>写法</th>
<th>是否推荐</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Base base = derived;</code>（赋值）</td>
<td>❌ 不推荐</td>
<td>除非明确只需要基类部分</td>
</tr>
<tr>
<td><code>Base&amp; ref = derived;</code>（引用）</td>
<td>✅ <strong>推荐</strong></td>
<td>需要多态、避免切片时</td>
</tr>
<tr>
<td><code>Base* ptr = &amp;derived;</code>（指针）</td>
<td>✅ <strong>更推荐</strong></td>
<td>更灵活，可以存储、传递</td>
</tr>
</tbody>
</table>
<h3 id="更推荐的替代方案base指针"><strong>更推荐的替代方案：<code>Base*</code>（指针）</strong> </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Base<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>derived<span class="token punctuation">;</span>  <span class="token comment">// 基类指针指向派生类对象</span>
ptr<span class="token operator">-&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 多态调用 Derived::print()</span>
</code></pre><p><strong>优点：</strong></p>
<ul>
<li>比引用更灵活（可以设为 <code>nullptr</code>，可以修改指向的对象）。</li>
<li>常用于运行时多态（如工厂模式、容器存储不同派生类对象）。</li>
</ul>
<hr>
<h2 id="4-总结-1"><strong>4. 总结</strong> </h2>
<ul>
<li><strong><code>Base&amp; ref = derived</code> 是推荐的</strong>，因为它避免了切片并支持多态，但必须确保 <code>derived</code> 的生命周期足够长。</li>
<li><strong><code>Base* ptr = &amp;derived</code> 更推荐</strong>，因为指针更灵活，适用于更多场景（如存储在不同容器中）。</li>
<li><strong><code>Base base = derived</code> 不推荐</strong>，除非你明确只需要基类部分（但通常应该使用组合而非继承）。</li>
</ul>
<h3 id="最佳实践"><strong>最佳实践</strong> </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// ✅ 推荐：指针方式（更灵活）</span>
Base<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>derived<span class="token punctuation">;</span>
ptr<span class="token operator">-&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 也可以：引用方式（适用于局部作用域）</span>
Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> derived<span class="token punctuation">;</span>
ref<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ❌ 不推荐：赋值方式（切片问题）</span>
Base base <span class="token operator">=</span> derived<span class="token punctuation">;</span>
base<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>如果你需要在函数参数中传递派生类对象，通常使用 <strong><code>const Base&amp;</code></strong>（避免拷贝）或 <strong><code>Base*</code></strong>（更灵活）。</p>
<hr>
<h3 id="三-派生类间的复制控制">三、派生类间的复制控制 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//DerivedCopyControl1.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pbase<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base(const char* pbase)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base(const Base&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	Base<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base&amp; operator=(const Base&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pbase<span class="token punctuation">;</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Base()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pbase<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pbase<span class="token punctuation">;</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _pbase<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pbase<span class="token punctuation">,</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pDerived<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Base</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_pDerived</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived(const char* pbase,const char* pDerived)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pDerived</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived(const Derived&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Derived<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived&amp; operator=(const Derived&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pDerived<span class="token punctuation">;</span>
			_pDerived <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>

			_pDerived <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token operator">~</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Derived()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pDerived<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pDerived<span class="token punctuation">;</span>
			_pDerived <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _pDerived<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//Base&amp; ref = rhs;//error!将 "Base &amp;" 类型的引用绑定到 "const Derived" 类型的初始值设定项时，限定符被丢弃</span>
	<span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> rhs<span class="token punctuation">;</span><span class="token comment">//正确写法</span>
	os <span class="token operator">&lt;&lt;</span> ref <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">;</span>
	
	<span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Derived <span class="token function">derived</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//用一个已经存在的对象去初始化一个刚刚创建的对象</span>
	Derived <span class="token function">derived2</span><span class="token punctuation">(</span>derived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived2 = "</span> <span class="token operator">&lt;&lt;</span> derived2 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Derived <span class="token function">derived3</span><span class="token punctuation">(</span><span class="token string">"cpp"</span><span class="token punctuation">,</span> <span class="token string">"difficult"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived3 = "</span> <span class="token operator">&lt;&lt;</span> derived3 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	
	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//两个派生类对象之间进行赋值</span>
	derived3 <span class="token operator">=</span> derived<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived3 = "</span> <span class="token operator">&lt;&lt;</span> derived3 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre><hr>
<p><strong><code>DerivedCopyControl2.cpp</code><strong>版本的cpp文件是为了解决上一个版本(</strong><code>DerivedCopyControl1.cpp</code></strong>)的潜在问题，主要问题如下：</p>
<ul>
<li>Base的拷贝构造函数和赋值运算符未处理源对象的_pbase为nullptr的情况，导致潜在崩溃。</li>
<li>Derived的拷贝构造函数未调用Base的拷贝构造函数，导致基类部分未被正确复制。</li>
<li>Derived的赋值运算符未调用Base的赋值运算符，导致基类部分未被正确赋值。</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//DerivedCopyControl2.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pbase<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base(const char* pbase)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*Base(const Base&amp; rhs)
		:_pbase(new char[strlen(rhs._pbase) + 1]())
	{
		cout &lt;&lt; "Base(const Base&amp; rhs)" &lt;&lt; endl;
		strcpy_s(_pbase, strlen(rhs._pbase) + 1, rhs._pbase);
	}*/</span>

	<span class="token comment">// 拷贝构造函数</span>
	<span class="token function">Base</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_pbase</span><span class="token punctuation">(</span><span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base(const Base&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*Base&amp; operator=(const Base&amp; rhs)
	{
		cout &lt;&lt; "Base&amp; operator=(const Base&amp; rhs)" &lt;&lt; endl;
		if (this != &amp;rhs)
		{
			delete[] _pbase;
			_pbase = nullptr;
			_pbase = new char[strlen(rhs._pbase) + 1]();
			strcpy_s(_pbase, strlen(rhs._pbase) + 1, rhs._pbase);
		}
		return *this;
	}*/</span>

	<span class="token comment">// 赋值运算符</span>
	Base<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base&amp; operator=(const Base&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pbase<span class="token punctuation">;</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">//base = new char[strlen(rhs._pbase) + 1]();</span>
				<span class="token comment">//使用new char[size]()会进行零初始化，随后strcpy_s会覆盖这些零。此举虽无害但影响性能。</span>
				_pbase <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 无需()</span>
				<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pbase<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Base()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pbase<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pbase<span class="token punctuation">;</span>
			_pbase <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _pbase<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		os <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_pbase<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pbase<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> pDerived<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Base</span><span class="token punctuation">(</span>pbase<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_pDerived</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived(const char* pbase,const char* pDerived)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	
	<span class="token comment">/*Derived(const Derived&amp; rhs)
		:_pDerived(new char[strlen(rhs._pDerived) + 1]())
	{
		cout &lt;&lt; "Derived(const Derived&amp; rhs)" &lt;&lt; endl;
		strcpy_s(_pDerived, strlen(rhs._pDerived) + 1, rhs._pDerived);
	}*/</span>

	<span class="token comment">// 拷贝构造函数</span>
	<span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">Base</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 调用基类拷贝构造</span>
		<span class="token function">_pDerived</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived(const Derived&amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	

	<span class="token comment">/*Derived&amp; operator=(const Derived&amp; rhs)
	{
		cout &lt;&lt; "Derived&amp; operator=(const Derived&amp; rhs)" &lt;&lt; endl;
		if (this != &amp;rhs)
		{
			delete[] _pDerived;
			_pDerived = nullptr;

			_pDerived = new char[strlen(rhs._pDerived) + 1]();
			strcpy_s(_pDerived, strlen(rhs._pDerived) + 1, rhs._pDerived);
		}
		return *this;
	}*/</span>

	<span class="token comment">// 赋值运算符</span>
	Derived<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			Base<span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用基类赋值运算符</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pDerived<span class="token punctuation">;</span>
			_pDerived <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">strcpy_s</span><span class="token punctuation">(</span>_pDerived<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Derived()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_pDerived<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _pDerived<span class="token punctuation">;</span>
			_pDerived <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token keyword keyword-char">char</span><span class="token operator">*</span> _pDerived<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Derived<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//Base&amp; ref = rhs;//error!将 "Base &amp;" 类型的引用绑定到 "const Derived" 类型的初始值设定项时，限定符被丢弃</span>
	<span class="token keyword keyword-const">const</span> Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> rhs<span class="token punctuation">;</span><span class="token comment">//正确写法</span>
	os <span class="token operator">&lt;&lt;</span> ref <span class="token operator">&lt;&lt;</span> rhs<span class="token punctuation">.</span>_pDerived<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Derived <span class="token function">derived</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//用一个已经存在的对象去初始化一个刚刚创建的对象</span>
	Derived <span class="token function">derived2</span><span class="token punctuation">(</span>derived<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived2 = "</span> <span class="token operator">&lt;&lt;</span> derived2 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	Derived <span class="token function">derived3</span><span class="token punctuation">(</span><span class="token string">"cpp"</span><span class="token punctuation">,</span> <span class="token string">"difficult"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived3 = "</span> <span class="token operator">&lt;&lt;</span> derived3 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//两个派生类对象之间进行赋值</span>
	derived3 <span class="token operator">=</span> derived<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived = "</span> <span class="token operator">&lt;&lt;</span> derived <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived3 = "</span> <span class="token operator">&lt;&lt;</span> derived3 <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre><p><strong>总结：</strong><br>
1、如果基类实现了拷贝构造函数或赋值运算符函数，但是派生类没有实现拷贝构造函数或赋值运算符函数，那么在将一个已经存在的派生类对象初始化一个刚刚创建的派生类对象，或者将两个派生类对象进行赋值，那么派生部分会执行缺省行为，而基类部分会执行基类的拷贝构造函数或者赋值运算符函数。</p>
<p>2、如果基类实现了拷贝构造函数或赋值运算符函数，并且派生类也实现拷贝构造函数或赋值运算符函数，那么在将一个已经存在的派生类对象初始化一个刚刚创建的派生类对象，或者将两个派生类对象进行赋值，那么派生部分会执行派生类自己的拷贝构造函数或者赋值运算符函数，而基类部分<strong>不会自动</strong>执行基类的拷贝构造函数或者赋值运算符函数，除非显示在派生类中调用基类的拷贝与赋值。</p>
<h3 id="四-多态重要">四、多态（重要） </h3>
<h4 id="1-多态的基础">1、多态的基础 </h4>
<p>面向对象的四大基本特征：抽象、封装、继承、多态。</p>
<p>多态：对于同一种指令（警车鸣笛），针对不同对象（警察、普通人、嫌疑犯），产生不一样的行为（行动、正常行走、藏起来）。</p>
<h4 id="2-多态的分类">2、多态的分类 </h4>
<p>静态多态：包括：函数重载、运算符重载、模板，<strong>发生的时机在编译的时候</strong>。</p>
<p>动态多态：<strong>发生的时机在运行的时候</strong>，使用<strong>虚函数</strong>进行体现</p>
<pre data-role="codeBlock" data-info="C++" class="language-cpp C++"><code><span class="token keyword keyword-int">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> dx<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> dy<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>

string <span class="token function">add</span><span class="token punctuation">(</span>string s1<span class="token punctuation">,</span> string s2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-虚函数">3、虚函数 </h4>
<p>概念：是一个<strong>成员函数</strong>，并且在前面加上<strong>virtual</strong>关键字</p>
<p>性质：如果在基类中定义类虚函数，那么在派生类中该函数就是虚函数，即使在派生类中没有加virtual</p>
<p>重定义（重写、覆盖）：派生类要保证该虚函数的名字与基类相同，函数的返回类型也要相同，函数的参数列表也要相同（包括参数的个数、参数的类型、参数的顺序），言外之意，唯一可以不一样的，就是函数体。</p>
<h4 id="4-虚函数原理重要">4、虚函数原理（重要） </h4>
<p>当基类定义了虚函数，就会在该类创建的对象的存储布局的前面，新增一个虚函数指针，该指针指向虚函数表（简称虚表），虚表中存的是虚函数的入口地址（有多少虚函数都会入虚表）。当派生类继承基类的时候，会满足吸收的特点，那么派生类也会有该虚函数，所以派生类创建的对象的布局的前面，也会新增一个虚函数指针，该指针指向派生类自己的虚函数表（简称虚表），虚表中存的是派生类的虚函数的入口地址（有多少虚函数都会入虚表），如果此时派生类重写了从基类这里吸收过来的虚函数，那么就会用派生类自己的虚函数的入口地址覆盖从基类这里吸收过来的虚函数的入口地址。</p>
<h4 id="5-虚函数机制被激活的条件重要">5、虚函数机制被激活的条件（重要） </h4>
<p>或者动态多态被激活的五个条件</p>
<p>1、基类定义虚函数</p>
<p>2、派生类重写（重定义、覆盖）该虚函数</p>
<p>3、创建派生类的对象</p>
<p>4、用基类的指针指向（引用绑定）派生类的对象</p>
<p>5、使用基类的指针（引用）调用该虚函数</p>
<h4 id="6-虚函数的限制">6、虚函数的限制 </h4>
<p>哪些函数不能被设置为虚函数？</p>
<p>1、普通函数（自由函数、全局函数）：虚函数必须是成员函数，而普通函数是非成员函数。</p>
<p>2、内联成员函数：内联成员函数进行函数替换的时候，发生时机在编译的时候，而虚函数要体现多态，发生时机在运行的时候；如果将内联函数设置为虚函数，那此时就会失去内联的含义。</p>
<p>3、静态成员函数：静态成员函数发生时机在编译的时候，而虚函数要体现多态，发生时机在运行的时候；静态成员函数是共享的，被该类的所有对象共享。没有this指针</p>
<p>4、友元函数：如果友元函数本身是一个普通函数，那么友元函数不能被设置为虚函数。如果友元函数本身是另外一个类的成员函数，是可以被设置为虚函数的。友元关系不能被继承。</p>
<p>5、构造函数：构造函数不能被继承，但是虚函数是可以被继承的；构造函数发生的时机在编译的时候，而虚函数要体现动态多态，发生的时机在运行的时候；<strong>如果构造函数被设置为虚函数，那么要体现出多态，就需要放在虚表中，需要使用虚函数指针找到虚表，而如果构造函数都不调用，那对象是没有完全创建出来的，对象都不完整，此时有没有虚函数指针都不一定。（重要）</strong></p>
<h4 id="7-虚函数的访问">7、虚函数的访问 </h4>
<p>1、使用指针与引用可以体现出动态多态</p>
<p>2、使用对象不能体现动态多态，体现的是虚函数作为普通函数的特征。</p>
<p>3、使用其他普通成员函数有可能体现动态多态</p>
<h4 id="8-抽象类">8、抽象类 </h4>
<p>抽象类是作为接口使用的。</p>
<hr>
<p>是的，<code>int &amp;ref = number;</code> 和 <code>Base &amp;ref = derived;</code> 这两种引用声明方式在<strong>语法形式上是相似的</strong>，但在<strong>语义和底层行为上有重要区别</strong>。下面我们详细对比它们的异同：</p>
<hr>
<h2 id="1-语法形式相似"><strong>1. 语法形式相似</strong> </h2>
<p>两种写法都遵循 C++ 引用的基本语法：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>T<span class="token operator">&amp;</span> ref <span class="token operator">=</span> obj<span class="token punctuation">;</span>  <span class="token comment">// T 是类型，obj 是已存在的对象</span>
</code></pre><ul>
<li><code>int&amp; ref = number;</code>：<code>ref</code> 是 <code>int</code> 的引用，绑定到 <code>number</code>。</li>
<li><code>Base&amp; ref = derived;</code>：<code>ref</code> 是 <code>Base</code> 的引用，绑定到 <code>derived</code>（派生类对象）。</li>
</ul>
<hr>
<h2 id="2-核心区别"><strong>2. 核心区别</strong> </h2>
<h3 id="1-引用绑定的对象类型"><strong>(1) 引用绑定的对象类型</strong> </h3>
<table>
<thead>
<tr>
<th>引用声明</th>
<th>绑定对象类型</th>
<th>是否允许</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>int&amp; ref = number;</code></td>
<td>相同类型（<code>int</code> → <code>int</code>）</td>
<td>✅ 允许</td>
</tr>
<tr>
<td><code>Base&amp; ref = derived;</code></td>
<td>派生类 → 基类（<code>Derived</code> → <code>Base</code>）</td>
<td>✅ 允许（多态）</td>
</tr>
<tr>
<td><code>Derived&amp; ref = base;</code></td>
<td>基类 → 派生类（<code>Base</code> → <code>Derived</code>）</td>
<td>❌ 错误（除非基类实际是派生类）</td>
</tr>
</tbody>
</table>
<p><strong>关键点</strong>：</p>
<ul>
<li>C++ 允许 <strong>基类引用绑定到派生类对象</strong>（向上转型，Upcasting），这是多态的基础。</li>
<li>但反过来（派生类引用绑定基类对象）是禁止的，除非通过 <code>dynamic_cast</code> 且基类具有多态性（含虚函数）。</li>
</ul>
<hr>
<h3 id="2-可访问的成员"><strong>(2) 可访问的成员</strong> </h3>
<table>
<thead>
<tr>
<th>引用类型</th>
<th>能访问的成员</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>int&amp; ref</code></td>
<td>可访问 <code>int</code> 的所有操作（如加减乘除）</td>
</tr>
<tr>
<td><code>Base&amp; ref</code></td>
<td>只能访问 <code>Base</code> 的成员，无法直接访问 <code>Derived</code> 的特有成员</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">base_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">derived_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Derived derived<span class="token punctuation">;</span>
    Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> derived<span class="token punctuation">;</span>

    ref<span class="token punctuation">.</span><span class="token function">base_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ✅ 允许</span>
    <span class="token comment">// ref.derived_func(); // ❌ 错误：Base 没有 derived_func</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3-多态行为虚函数"><strong>(3) 多态行为（虚函数）</strong> </h3>
<p>如果 <code>Base</code> 有虚函数，且 <code>Derived</code> 覆盖了它，通过 <code>Base&amp; ref</code> 调用时会触发动态绑定：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Base\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Derived derived<span class="token punctuation">;</span>
    Base<span class="token operator">&amp;</span> ref <span class="token operator">=</span> derived<span class="token punctuation">;</span>
    ref<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "Derived"（多态调用）</span>
<span class="token punctuation">}</span>
</code></pre><p>而 <code>int&amp;</code> 不涉及多态，因为内置类型（如 <code>int</code>）没有虚函数。</p>
<hr>
<h2 id="3-底层机制"><strong>3. 底层机制</strong> </h2>
<ul>
<li><code>int&amp; ref = number;</code>：
<ul>
<li><code>ref</code> 直接绑定到 <code>number</code> 的内存地址，操作 <code>ref</code> 等同于操作 <code>number</code>。</li>
</ul>
</li>
<li><code>Base&amp; ref = derived;</code>：
<ul>
<li><code>ref</code> 绑定到 <code>derived</code> 对象中的 <strong>基类子对象部分</strong>（即 <code>Base</code> 的部分）。</li>
<li>如果 <code>Base</code> 有虚函数，<code>ref</code> 会通过虚表（vtable）实现多态。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-总结-2"><strong>4. 总结</strong> </h2>
<table>
<thead>
<tr>
<th>特性</th>
<th><code>int&amp; ref = number;</code></th>
<th><code>Base&amp; ref = derived;</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>绑定类型</strong></td>
<td>相同类型（<code>int</code> → <code>int</code>）</td>
<td>派生类 → 基类（<code>Derived</code> → <code>Base</code>）</td>
</tr>
<tr>
<td><strong>是否支持多态</strong></td>
<td>否（<code>int</code> 无虚函数）</td>
<td>是（如果 <code>Base</code> 有虚函数）</td>
</tr>
<tr>
<td><strong>可访问成员</strong></td>
<td>全部 <code>int</code> 操作</td>
<td>仅 <code>Base</code> 的成员</td>
</tr>
<tr>
<td><strong>底层行为</strong></td>
<td>直接别名</td>
<td>绑定到派生类对象的基类部分</td>
</tr>
</tbody>
</table>
<h3 id="关键结论"><strong>关键结论</strong> </h3>
<ol>
<li><strong>语法形式相同</strong>，但 <code>Base&amp; ref = derived;</code> 利用了 C++ 的多态特性。</li>
<li><strong>推荐使用基类引用/指针绑定派生类对象</strong>，以实现运行时多态（比直接赋值 <code>Base base = derived;</code> 更高效且安全）。</li>
<li>如果不需要多态，优先使用 <strong>值类型或模板</strong>，而非继承体系。</li>
</ol>
<hr>
<h1 id="c-中创建线程并传入类类型的正确写法">C++ 中创建线程并传入类类型的正确写法 </h1>
<p>在 C++ 中创建线程并传入类类型有几种正确的方式，主要取决于你想如何传递类实例以及如何使用它。以下是几种常见的正确写法：</p>
<h2 id="1-传递成员函数使用对象指针">1. 传递成员函数（使用对象指针） </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">memberFunction</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Member function called with "</span> <span class="token operator">&lt;&lt;</span> x 
                  <span class="token operator">&lt;&lt;</span> <span class="token string">" (thread ID: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyClass obj<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>MyClass<span class="token double-colon punctuation">::</span>memberFunction<span class="token punctuation">,</span> <span class="token operator">&amp;</span>obj<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="2-传递-lambda-表达式捕获对象">2. 传递 lambda 表达式捕获对象 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Functor called with "</span> <span class="token operator">&lt;&lt;</span> x 
                  <span class="token operator">&lt;&lt;</span> <span class="token string">" (thread ID: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyClass obj<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>obj<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">obj</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="3-传递临时对象移动语义">3. 传递临时对象（移动语义） </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Temporary object called"</span>
                  <span class="token operator">&lt;&lt;</span> <span class="token string">" (thread ID: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 注意：这里可能会被解析为函数声明</span>
    <span class="token comment">// 更好的写法：</span>
    <span class="token comment">// std::thread t{MyClass()};</span>
    <span class="token comment">// 或</span>
    <span class="token comment">// std::thread t((MyClass()));</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="4-使用-stdref-传递引用">4. 使用 std::ref 传递引用 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;functional&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Object called by reference"</span>
                  <span class="token operator">&lt;&lt;</span> <span class="token string">" (thread ID: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyClass obj<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">ref</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="5-使用智能指针">5. 使用智能指针 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-void">void</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Shared object called"</span>
                  <span class="token operator">&lt;&lt;</span> <span class="token string">" (thread ID: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-auto">auto</span> obj <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token operator">*</span>obj<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="注意事项">注意事项 </h2>
<ol>
<li>线程的生命周期必须长于或等于它所引用的对象</li>
<li>如果需要共享对象，确保线程安全性（使用互斥锁等）</li>
<li>避免悬垂引用（不要传递局部变量的引用给可能比它生命周期长的线程）</li>
<li>考虑使用 join() 或 detach() 明确线程的结束方式</li>
</ol>
<p>选择哪种方式取决于你的具体需求，如对象生命周期管理、是否需要修改对象状态等。</p>
<hr>
<h3 id="问题描述">问题描述 </h3>
<p>我们有以下C++代码：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B\n"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D\n"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    D d<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>运行这段代码时，输出的是 <code>B</code> 而不是 <code>D</code>。这是为什么？</p>
<h3 id="初步观察">初步观察 </h3>
<p>首先，我们有一个基类 <code>B</code> 和一个派生类 <code>D</code>。<code>B</code> 的构造函数中调用了虚函数 <code>test()</code>，而 <code>D</code> 重写了这个虚函数。当我们创建一个 <code>D</code> 的对象时，<code>B</code> 的构造函数会被调用，然后在 <code>B</code> 的构造函数中调用了 <code>test()</code>。然而，输出的是 <code>B</code> 的 <code>test()</code> 实现，而不是 <code>D</code> 的。</p>
<h3 id="理解对象构造过程">理解对象构造过程 </h3>
<p>在C++中，对象的构造是从基类到派生类的顺序进行的。具体到这段代码：</p>
<ol>
<li>当创建 <code>D</code> 的对象 <code>d</code> 时，首先调用 <code>B</code> 的构造函数。</li>
<li>在 <code>B</code> 的构造函数中，调用了 <code>test()</code>。</li>
<li>之后，<code>D</code> 的构造函数被调用（这里 <code>D</code> 的构造函数是默认的，没有额外操作）。</li>
</ol>
<h3 id="虚函数在构造函数中的行为">虚函数在构造函数中的行为 </h3>
<p>关键在于：<strong>在构造函数中调用虚函数时，虚函数的动态绑定（多态）行为不会发生</strong>。也就是说，在 <code>B</code> 的构造函数中调用 <code>test()</code> 时，它调用的是 <code>B</code> 的 <code>test()</code>，而不是 <code>D</code> 的 <code>test()</code>。</p>
<p>这是因为：</p>
<ul>
<li>当 <code>B</code> 的构造函数正在执行时，<code>D</code> 的部分还没有被构造。此时对象的 <code>D</code> 部分还不完整，因此不能安全地调用 <code>D</code> 的重写函数。</li>
<li>C++ 的设计决定了在基类的构造函数中，虚函数调用被解析为当前类（即基类）的实现，而不是派生类的实现。这是为了避免在对象未完全构造时调用未初始化的派生类成员。</li>
</ul>
<h3 id="c标准的规定">C++标准的规定 </h3>
<p>根据C++标准（如ISO/IEC 14882:2017）：</p>
<blockquote>
<p>When a virtual function is called directly or indirectly from a constructor or from a destructor, including during the construction or destruction of the class’s non-static data members, and the object to which the call applies is the object under construction or destruction, the function called is the one defined in the constructor or destructor’s own class or in one of its bases, but not a function overriding it in a class derived from the constructor or destructor’s class, or overriding it in one of the other base classes of the most derived object.</p>
</blockquote>
<p>简单来说，在构造函数或析构函数中调用虚函数时，调用的版本是当前构造函数或析构函数所在类的版本，而不是派生类的重写版本。</p>
<h3 id="示例验证">示例验证 </h3>
<p>让我们稍微修改代码，以更清楚地看到构造顺序：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B constructor\n"</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B::test\n"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D constructor\n"</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D::test\n"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    D d<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>输出：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>B constructor
B::test
D constructor
D::test
</code></pre><p>可以看到：</p>
<ol>
<li><code>B</code> 的构造函数先被调用，此时 <code>test()</code> 调用的是 <code>B::test()</code>。</li>
<li>然后 <code>D</code> 的构造函数被调用，此时 <code>test()</code> 调用的是 <code>D::test()</code>。</li>
</ol>
<h3 id="为什么这样设计">为什么这样设计？ </h3>
<p>这种设计是为了保证对象构造的安全性。考虑以下情况：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果这里调用 D::test()，而 D 的成员还未初始化</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> x<span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> x<span class="token punctuation">;</span>  <span class="token comment">// 如果 B::B() 中调用 D::test()，x 还未初始化</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>如果在 <code>B</code> 的构造函数中调用 <code>D::test()</code>，而 <code>D</code> 的成员 <code>x</code> 还未初始化（因为 <code>D</code> 的构造函数还未执行），那么访问 <code>x</code> 将是未定义行为。因此，C++ 规定在构造函数中虚函数调用不进行动态绑定，而是使用当前类的实现。</p>
<h3 id="类似行为析构函数">类似行为：析构函数 </h3>
<p>类似的情况也适用于析构函数：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token operator">~</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用 B::test()，即使是在 ~D() 中</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B::test\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token operator">~</span><span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// D 的部分已经被销毁</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D::test\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    B<span class="token operator">*</span> b <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-delete">delete</span> b<span class="token punctuation">;</span>  <span class="token comment">// 输出 B::test</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>在析构函数中，派生类的部分已经被销毁，因此虚函数调用也会被解析为当前类的实现，以避免访问已销毁的派生类成员。</p>
<h3 id="解决方案">解决方案 </h3>
<p>如果需要在构造时调用派生类的虚函数实现，可以考虑以下方法：</p>
<ol>
<li>
<p><strong>不要在构造函数中调用虚函数</strong>：这是最直接的解决方案。将需要在构造后进行的操作移到单独的初始化函数中，由用户显式调用。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 构造后由用户调用</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B::test\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D::test\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    D d<span class="token punctuation">;</span>
    d<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出 D::test</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>使用工厂模式</strong>：通过工厂函数创建对象，并在构造后调用虚函数。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"B::test\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">B</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> <span class="token keyword keyword-void">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"D::test\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
T<span class="token operator">*</span> <span class="token function">createAndTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    T<span class="token operator">*</span> obj <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token operator">-&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 安全调用派生类的实现</span>
    <span class="token keyword keyword-return">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    D<span class="token operator">*</span> d <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createAndTest</span><span class="token generic class-name"><span class="token operator">&lt;</span>D<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出 D::test</span>
    <span class="token keyword keyword-delete">delete</span> d<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<h3 id="总结-1">总结 </h3>
<ul>
<li>在构造函数中调用虚函数时，调用的版本是当前构造函数所在类的实现，而不是派生类的重写版本。</li>
<li>这是因为派生类的部分在基类构造函数执行时还未构造完成，调用派生类的虚函数可能导致未定义行为。</li>
<li>这种设计是C++语言为了保证对象构造的安全性而做出的规定。</li>
<li>如果需要多态行为，应避免在构造函数中调用虚函数，或通过其他方式（如初始化函数或工厂模式）实现。</li>
</ul>
<h3 id="最终答案">最终答案 </h3>
<p>在 <code>D d;</code> 的构造过程中，<code>B</code> 的构造函数首先被调用。在 <code>B</code> 的构造函数中调用虚函数 <code>test()</code> 时，由于 <code>D</code> 的部分尚未构造完成，C++ 的规则规定此时虚函数的调用被静态绑定到当前类（即 <code>B</code>）的实现，而不是派生类 <code>D</code> 的重写版本。因此，输出的是 <code>B</code> 而不是 <code>D</code>。这是C++为了保证对象构造的安全性而设计的特性。</p>
<hr>
<p>🚀</p>
<h3 id="三级标题">三级标题 </h3>
<h4 id="四级标题">四级标题 </h4>
<h5 id="五级标题">五级标题 </h5>
<h6 id="六级标题">六级标题 </h6>
<p><strong>加粗</strong> 或者 <strong>加粗</strong><br>
<em>斜体</em> 或者 <em>斜体</em><br>
<em><strong>加粗+斜体</strong></em> 或者 <em><strong>加粗+斜体</strong></em></p>
<ul>
<li>项目 1</li>
<li>项目 2
<ul>
<li>子项 2.1</li>
<li>子项 2.2</li>
</ul>
</li>
</ul>
<ul>
<li>另一种写法</li>
</ul>
<ol>
<li>第一项</li>
<li>第二项</li>
<li>第三项</li>
</ol>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>
